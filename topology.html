<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2A隐蔽通信系统</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #2d3748 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            overflow-x: auto;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFlow 20s ease-in-out infinite;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 60% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 20% 60%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFlow 25s ease-in-out infinite reverse;
        }
        
        @keyframes backgroundFlow {
            0%, 100% {
                transform: translateX(0) translateY(0) scale(1);
                opacity: 0.8;
            }
            25% {
                transform: translateX(20px) translateY(-10px) scale(1.05);
                opacity: 1;
            }
            50% {
                transform: translateX(-10px) translateY(20px) scale(0.95);
                opacity: 0.9;
            }
            75% {
                transform: translateX(15px) translateY(-15px) scale(1.02);
                opacity: 1;
            }
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 60% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 20% 60%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFlow 25s ease-in-out infinite reverse;
        }
        
        /* 添加流动的粒子效果 */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 20s;
        }
        
        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            left: 20%;
            animation-delay: 2s;
            animation-duration: 18s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            left: 30%;
            animation-delay: 4s;
            animation-duration: 22s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        .particle:nth-child(4) {
            width: 5px;
            height: 5px;
            left: 40%;
            animation-delay: 6s;
            animation-duration: 16s;
        }
        
        .particle:nth-child(5) {
            width: 4px;
            height: 4px;
            left: 50%;
            animation-delay: 8s;
            animation-duration: 24s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(6) {
            width: 6px;
            height: 6px;
            left: 60%;
            animation-delay: 10s;
            animation-duration: 19s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        .particle:nth-child(7) {
            width: 3px;
            height: 3px;
            left: 70%;
            animation-delay: 12s;
            animation-duration: 21s;
        }
        
        .particle:nth-child(8) {
            width: 5px;
            height: 5px;
            left: 80%;
            animation-delay: 14s;
            animation-duration: 17s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(9) {
            width: 4px;
            height: 4px;
            left: 90%;
            animation-delay: 16s;
            animation-duration: 23s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 添加波浪流动效果 */
        .wave-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                rgba(102, 126, 234, 0.1) 0%, 
                rgba(255, 119, 198, 0.1) 25%, 
                rgba(120, 219, 255, 0.1) 50%, 
                rgba(102, 126, 234, 0.1) 75%, 
                rgba(255, 119, 198, 0.1) 100%);
            animation: waveFlow 30s ease-in-out infinite;
            border-radius: 50%;
        }
        
        .wave:nth-child(2) {
            animation-delay: -10s;
            animation-duration: 25s;
            background: linear-gradient(135deg, 
                rgba(120, 219, 255, 0.08) 0%, 
                rgba(102, 126, 234, 0.08) 25%, 
                rgba(255, 119, 198, 0.08) 50%, 
                rgba(120, 219, 255, 0.08) 75%, 
                rgba(102, 126, 234, 0.08) 100%);
        }
        
        .wave:nth-child(3) {
            animation-delay: -20s;
            animation-duration: 35s;
            background: linear-gradient(225deg, 
                rgba(255, 119, 198, 0.06) 0%, 
                rgba(120, 219, 255, 0.06) 25%, 
                rgba(102, 126, 234, 0.06) 50%, 
                rgba(255, 119, 198, 0.06) 75%, 
                rgba(120, 219, 255, 0.06) 100%);
        }
        
        @keyframes waveFlow {
            0%, 100% {
                transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1);
                opacity: 0.3;
            }
            25% {
                transform: translateX(-30%) translateY(-40%) rotate(90deg) scale(1.2);
                opacity: 0.5;
            }
            50% {
                transform: translateX(-40%) translateY(-60%) rotate(180deg) scale(0.8);
                opacity: 0.4;
            }
            75% {
                transform: translateX(-60%) translateY(-30%) rotate(270deg) scale(1.1);
                opacity: 0.6;
            }
        }
        
        .main-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .main-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .main-header p {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .oasis-platform {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            min-height: 80vh;
        }
        
        .earth-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            padding: 40px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .world-map {
            width: 100%;
            height: 700px;
            background-image: url('photos/view.png');
            background-size: 95%;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(50px) saturate(200%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset,
                0 -1px 0 rgba(0, 0, 0, 0.05) inset;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.05) 50%, 
                rgba(255, 255, 255, 0.2) 100%);
            backdrop-filter: blur(10px);
        }
        
        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px 20px;
            border-radius: 16px;
            position: relative;
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.06),
                0 1px 0 rgba(255, 255, 255, 0.06) inset;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .panel-title.left {
            background: rgba(52, 152, 219, 0.05);
            border: 1px solid rgba(52, 152, 219, 0.12);
            color: white;
        }
        
        .panel-title.center {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.12);
            color: white;
        }
        
        .panel-title.right {
            background: rgba(231, 76, 60, 0.05);
            border: 1px solid rgba(231, 76, 60, 0.12);
            color: white;
        }
        
        .panel-title::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -5px;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .topology-section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .section-title::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.6), rgba(118, 75, 162, 0.6));
            backdrop-filter: blur(10px);
        }
        
        .agent-nodes-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .agent-node {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            background: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 60px;
            height: 60px;
            pointer-events: all;
            z-index: 10;
        }
        
        .agent-node:hover {
            transform: translateY(-5px) scale(1.1);
            filter: drop-shadow(0 10px 20px rgba(102, 126, 234, 0.6));
        }
        
        .agent-node.selected-sender {
            transform: scale(1.2);
            filter: drop-shadow(0 0 20px rgba(231, 76, 60, 0.8));
        }
        
        .agent-node.selected-receiver {
            transform: scale(1.2);
            filter: drop-shadow(0 0 20px rgba(39, 174, 96, 0.8));
        }
        
        .agent-node.selected-sender:hover,
        .agent-node.selected-receiver:hover {
            transform: scale(1.3) translateY(-5px);
        }
        
        .agent-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .agent-icon img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .agent-name {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            text-align: center;
            background: none;
            padding: 0;
        }
        
        .agent-status {
            display: none;
        }
        
        
        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-path {
            fill: none;
            stroke-width: 1.5;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        /* 不同Agent连线的颜色 */
        .connection-path.nexus-atlas { stroke: url(#nexus-atlas-gradient); filter: drop-shadow(0 0 3px rgba(255, 107, 107, 0.3)); }
        .connection-path.nexus-phoenix { stroke: url(#nexus-phoenix-gradient); filter: drop-shadow(0 0 3px rgba(78, 205, 196, 0.3)); }
        .connection-path.nexus-sentinel { stroke: url(#nexus-sentinel-gradient); filter: drop-shadow(0 0 3px rgba(69, 183, 209, 0.3)); }
        .connection-path.nexus-orion { stroke: url(#nexus-orion-gradient); filter: drop-shadow(0 0 3px rgba(240, 147, 251, 0.3)); }
        .connection-path.nexus-frost { stroke: url(#nexus-frost-gradient); filter: drop-shadow(0 0 3px rgba(79, 172, 254, 0.3)); }
        .connection-path.nexus-titan { stroke: url(#nexus-titan-gradient); filter: drop-shadow(0 0 3px rgba(67, 233, 123, 0.3)); }
        .connection-path.nexus-nova { stroke: url(#nexus-nova-gradient); filter: drop-shadow(0 0 3px rgba(250, 112, 154, 0.3)); }
        
        .connection-path.atlas-phoenix { stroke: url(#atlas-phoenix-gradient); filter: drop-shadow(0 0 3px rgba(102, 126, 234, 0.3)); }
        .connection-path.atlas-sentinel { stroke: url(#atlas-sentinel-gradient); filter: drop-shadow(0 0 3px rgba(240, 147, 251, 0.3)); }
        .connection-path.atlas-orion { stroke: url(#atlas-orion-gradient); filter: drop-shadow(0 0 3px rgba(79, 172, 254, 0.3)); }
        .connection-path.atlas-frost { stroke: url(#atlas-frost-gradient); filter: drop-shadow(0 0 3px rgba(67, 233, 123, 0.3)); }
        .connection-path.atlas-titan { stroke: url(#atlas-titan-gradient); filter: drop-shadow(0 0 3px rgba(250, 112, 154, 0.3)); }
        .connection-path.atlas-nova { stroke: url(#atlas-nova-gradient); filter: drop-shadow(0 0 3px rgba(255, 154, 158, 0.3)); }
        
        .connection-path.phoenix-sentinel { stroke: url(#phoenix-sentinel-gradient); filter: drop-shadow(0 0 3px rgba(168, 237, 234, 0.3)); }
        .connection-path.phoenix-orion { stroke: url(#phoenix-orion-gradient); filter: drop-shadow(0 0 3px rgba(210, 153, 194, 0.3)); }
        .connection-path.phoenix-frost { stroke: url(#phoenix-frost-gradient); filter: drop-shadow(0 0 3px rgba(137, 247, 254, 0.3)); }
        .connection-path.phoenix-titan { stroke: url(#phoenix-titan-gradient); filter: drop-shadow(0 0 3px rgba(253, 187, 45, 0.3)); }
        .connection-path.phoenix-nova { stroke: url(#phoenix-nova-gradient); filter: drop-shadow(0 0 3px rgba(255, 154, 158, 0.3)); }
        
        .connection-path.sentinel-orion { stroke: url(#sentinel-orion-gradient); filter: drop-shadow(0 0 3px rgba(255, 236, 210, 0.3)); }
        .connection-path.sentinel-frost { stroke: url(#sentinel-frost-gradient); filter: drop-shadow(0 0 3px rgba(168, 237, 234, 0.3)); }
        .connection-path.sentinel-titan { stroke: url(#sentinel-titan-gradient); filter: drop-shadow(0 0 3px rgba(210, 153, 194, 0.3)); }
        .connection-path.sentinel-nova { stroke: url(#sentinel-nova-gradient); filter: drop-shadow(0 0 3px rgba(137, 247, 254, 0.3)); }
        
        .connection-path.orion-frost { stroke: url(#orion-frost-gradient); filter: drop-shadow(0 0 3px rgba(253, 187, 45, 0.3)); }
        .connection-path.orion-titan { stroke: url(#orion-titan-gradient); filter: drop-shadow(0 0 3px rgba(255, 154, 158, 0.3)); }
        .connection-path.orion-nova { stroke: url(#orion-nova-gradient); filter: drop-shadow(0 0 3px rgba(255, 236, 210, 0.3)); }
        
        .connection-path.frost-titan { stroke: url(#frost-titan-gradient); filter: drop-shadow(0 0 3px rgba(168, 237, 234, 0.3)); }
        .connection-path.frost-nova { stroke: url(#frost-nova-gradient); filter: drop-shadow(0 0 3px rgba(210, 153, 194, 0.3)); }
        
        .connection-path.titan-nova { stroke: url(#titan-nova-gradient); filter: drop-shadow(0 0 3px rgba(137, 247, 254, 0.3)); }
        
        .connection-path.highlighted {
            stroke-width: 3;
            opacity: 1;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            animation: pulse 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            0% {
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            }
            100% {
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 1));
            }
        }
        
        .connection-path.normal {
            stroke-width: 1.5;
            opacity: 0.6;
            animation: none;
            filter: none;
        }
        
        .selection-info {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .selection-info.has-selection {
            border-color: rgba(102, 126, 234, 0.4);
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(30px);
        }
        
        .selection-info h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .selection-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .selection-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .selection-item.sender {
            border-color: rgba(231, 76, 60, 0.3);
            background: rgba(231, 76, 60, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .selection-item.receiver {
            border-color: rgba(39, 174, 96, 0.3);
            background: rgba(39, 174, 96, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .selection-icon {
            font-size: 1.5rem;
        }
        
        .selection-text {
            font-weight: 500;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .selection-text .agent-name {
            color: #ffffff;
            font-weight: 600;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 30px;
        }
        
        .btn {
            background: rgba(0, 0, 0, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1.1rem;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(25px);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .btn:disabled {
            background: rgba(0, 0, 0, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.05);
            opacity: 0.5;
            backdrop-filter: blur(10px);
        }
        
        .btn-start {
            background: rgba(39, 174, 96, 0.15);
            border: 1px solid rgba(39, 174, 96, 0.2);
            box-shadow: 0 10px 40px rgba(39, 174, 96, 0.3);
        }
        
        .btn-start:hover {
            box-shadow: 0 15px 50px rgba(39, 174, 96, 0.4);
            border-color: rgba(39, 174, 96, 0.3);
        }
        
        .btn-reset {
            background: rgba(149, 165, 166, 0.15);
            border: 1px solid rgba(149, 165, 166, 0.2);
            box-shadow: 0 10px 40px rgba(149, 165, 166, 0.3);
        }
        
        .btn-reset:hover {
            box-shadow: 0 15px 50px rgba(149, 165, 166, 0.4);
            border-color: rgba(149, 165, 166, 0.3);
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid rgba(102, 126, 234, 0.6);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .instructions h4 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .instructions ol {
            padding-left: 20px;
            line-height: 1.8;
        }
        
        .instructions li {
            margin-bottom: 8px;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: 400;
        }
        
        .instructions .highlight {
            color: #ffffff;
            font-weight: 600;
        }
        
        /* 新的面板内容样式 */
        .communication-flow {
            margin: 20px 0;
        }
        
        .flow-step {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid rgba(52, 152, 219, 0.6);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .flow-step:hover {
            transform: translateX(5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
        }
        
        .flow-step.active {
            border-left-color: rgba(231, 76, 60, 0.6);
            background: rgba(231, 76, 60, 0.1);
        }
        
        .flow-step.completed {
            border-left-color: rgba(39, 174, 96, 0.6);
            background: rgba(39, 174, 96, 0.1);
        }
        
        .demo-preview {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .demo-preview h4 {
            color: #ffffff;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .demo-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            min-width: 80px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #ffffff;
            margin-top: 5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: 500;
        }
        
        .arrow-indicator {
            text-align: center;
            font-size: 2rem;
            color: #ffffff;
            margin: 20px 0;
            animation: pulse 2s infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* 角标样式 */
        .selection-badges {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        
        .selection-badge {
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .selection-badge.sender {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .selection-badge.receiver {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        
        .action-buttons-bottom {
            position: absolute;
            bottom: 2px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        
        .demo-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .demo-card {
            background: rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .demo-card h4 {
            color: #ffffff;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .oasis-platform {
                flex-direction: column;
                gap: 15px;
            }
            
            .panel {
                min-height: auto;
            }
        }
        
        @media (max-width: 768px) {
            .topology-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, 1fr);
                gap: 20px;
                min-height: 250px;
            }
            
            .selection-details {
                flex-direction: column;
                gap: 15px;
            }
            
            .main-header h1 {
                font-size: 1.8rem;
            }
            
            .panel {
                padding: 15px;
            }
            
            .demo-stats {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .topology-grid {
                gap: 15px;
                min-height: 200px;
            }
            
            .agent-node {
                padding: 10px;
            }
            
            .agent-icon {
                font-size: 2rem;
            }
            
            .panel-title {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- 波浪流动背景 -->
    <div class="wave-background">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    
    <!-- 流动粒子背景 -->
    <div class="floating-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="main-header">
        <h1>🌴A2A隐蔽通信模拟平台</h1>
        <p>Agent网络拓扑图 - 选择隐蔽通信路径</p>
    </div>

    <div class="oasis-platform">
        <!-- 世界地图容器和Agent分布 -->
        <div class="earth-container">
            <div class="world-map"></div>
            
            <!-- Agent节点容器 -->
            <div class="agent-nodes-container" id="agentNodesContainer">
                <!-- Agent节点将通过JavaScript动态生成 -->
        </div>

            <!-- SVG连接线容器 -->
            <svg class="connection-svg" id="connectionSvg">
                <defs>
                    <!-- 渐变定义 - 现代柔和色彩 -->
                    <linearGradient id="nexus-atlas-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-phoenix-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="nexus-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="atlas-phoenix-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="atlas-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="atlas-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="atlas-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="atlas-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="atlas-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="phoenix-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="phoenix-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="phoenix-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="phoenix-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="phoenix-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="sentinel-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="sentinel-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="sentinel-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="sentinel-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="orion-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="orion-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="orion-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="frost-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="frost-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="titan-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </svg>
            
            <!-- 角标显示选择状态 -->
            <div class="selection-badges">
                <div class="selection-badge sender" id="senderBadge">
                    <span>📤</span>
                    <span>发送方: <span class="agent-name">未选择</span></span>
                    </div>
                <div class="selection-badge receiver" id="receiverBadge">
                    <span>📥</span>
                    <span>接收方: <span class="agent-name">未选择</span></span>
                </div>
            </div>
            
            <!-- 底部按钮 -->
            <div class="action-buttons-bottom">
                <button class="btn btn-reset" onclick="resetSelection()">🔄 重新选择</button>
                <button class="btn btn-start" id="startBtn" onclick="startCovertCommunication()" disabled>
                    🚀 开始隐蔽通信
                </button>
            </div>
        </div>

        <!-- 底部隐蔽通信演示区域 -->
        <div class="demo-section">
            <div class="demo-card">
                <h4>📊 通信统计</h4>
                <div class="demo-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="covertMessages">0</div>
                        <div class="stat-label">隐蔽消息</div>
                        </div>
                    <div class="stat-item">
                        <div class="stat-number" id="successRate">0%</div>
                        <div class="stat-label">成功率</div>
                        </div>
                    <div class="stat-item">
                        <div class="stat-number" id="detectionRate">0%</div>
                        <div class="stat-label">检测率</div>
                        </div>
                    </div>
                </div>
            
            <div class="demo-card">
                <h4>🎯 演示功能</h4>
                <ul style="text-align: left; color: #ffffff; font-size: 0.9rem; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                    <li>• 实时消息传输</li>
                    <li>• 隐蔽性检测</li>
                    <li>• 网络流量分析</li>
                    <li>• 安全性评估</li>
                </ul>
        </div>

            <div class="demo-card">
                <h4>📈 系统状态</h4>
                <div style="color: #27ae60; font-weight: bold; text-align: center;">
                    ✅ 系统就绪，等待选择Agent
                    </div>
                </div>
                
            <div class="demo-card">
                <h4>🌐 网络拓扑</h4>
                <div class="demo-stats">
                    <div class="stat-item">
                        <div class="stat-number">8</div>
                        <div class="stat-label">Agent节点</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">28</div>
                        <div class="stat-label">连接路径</div>
                </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">在线率</div>
            </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        // Agent网络配置 - 每个Agent都有独特的定义和图片图标
        const agents = [
            { 
                id: 'agent-1', 
                name: 'NEXUS', 
                status: '在线', 
                icon: 'photos/Robot Color.png',
                location: '美国东部',
                description: '北美数据中心',
                region: 'North America'
            },
            { 
                id: 'agent-2', 
                name: 'ATLAS', 
                status: '在线', 
                icon: 'photos/Robot Color(2).png',
                location: '欧洲',
                description: '欧洲云服务器',
                region: 'Europe'
            },
            { 
                id: 'agent-3', 
                name: 'PHOENIX', 
                status: '在线', 
                icon: 'photos/Robot Color(3).png',
                location: '中国东部',
                description: '亚洲核心节点',
                region: 'Asia'
            },
            { 
                id: 'agent-4', 
                name: 'SENTINEL', 
                status: '在线', 
                icon: 'photos/Robot Color(4).png',
                location: '非洲',
                description: '非洲中继站',
                region: 'Africa'
            },
            { 
                id: 'agent-5', 
                name: 'ORION', 
                status: '在线', 
                icon: 'photos/Robot Color(5).png',
                location: '澳洲',
                description: '大洋洲节点',
                region: 'Oceania'
            },
            { 
                id: 'agent-6', 
                name: 'FROST', 
                status: '在线', 
                icon: 'photos/Robot Color(6).png',
                location: '加拿大',
                description: '北美备份节点',
                region: 'North America'
            },
            { 
                id: 'agent-7', 
                name: 'TITAN', 
                status: '在线', 
                icon: 'photos/Robot Color(7).png',
                location: '俄罗斯',
                description: '欧亚桥接节点',
                region: 'Asia'
            },
            { 
                id: 'agent-8', 
                name: 'NOVA', 
                status: '在线', 
                icon: 'photos/Robot Color(8).png',
                location: '巴西',
                description: '南美中心节点',
                region: 'South America'
            }
        ];

        // Agent在世界地图上的分布位置（每个Agent可以单独调整）
        const agentPositions = {
            'agent-1': { x: 25, y: 50, name: 'NEXUS', region: '美国东部' },
            'agent-2': { x: 55, y: 40, name: 'ATLAS', region: '欧洲' },
            'agent-3': { x: 80, y: 54, name: 'PHOENIX', region: '中国东部' },
            'agent-4': { x: 58, y: 60, name: 'SENTINEL', region: '非洲' },
            'agent-5': { x: 85, y: 85, name: 'ORION', region: '澳洲' },
            'agent-6': { x: 20, y: 35, name: 'FROST', region: '加拿大' },
            'agent-7': { x: 75, y: 30, name: 'TITAN', region: '俄罗斯' },
            'agent-8': { x: 35, y: 77, name: 'NOVA', region: '巴西' }
        };

        // 连接配置（所有Agent之间都连接，但通过优化路径减少重叠）
        const connections = [];
        for (let i = 0; i < agents.length; i++) {
            for (let j = i + 1; j < agents.length; j++) {
                connections.push({ from: i, to: j });
            }
        }

        let selectedSender = null;
        let selectedReceiver = null;
        // 连接线可见性状态
        let connectionLinesVisible = false;

        // Agent位置调整函数 - 方便单独调整每个Agent的位置
        function updateAgentPosition(agentId, newX, newY) {
            if (agentPositions[agentId]) {
                agentPositions[agentId].x = newX;
                agentPositions[agentId].y = newY;
                // 重新初始化拓扑图以应用新位置
                setTimeout(() => {
                    const container = document.getElementById('agentNodesContainer');
                    container.innerHTML = '';
                    const linesContainer = document.getElementById('connectionLines');
                    linesContainer.innerHTML = '';
                    initializeTopology();
                }, 100);
            }
        }

        // 获取Agent当前位置
        function getAgentPosition(agentId) {
            return agentPositions[agentId] ? { x: agentPositions[agentId].x, y: agentPositions[agentId].y } : null;
        }

        // 初始化拓扑图
        function initializeTopology() {
            const container = document.getElementById('agentNodesContainer');
            const worldMap = document.querySelector('.world-map');
            const worldMapRect = worldMap.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // 生成Agent节点
            agents.forEach((agent, index) => {
                const agentNode = document.createElement('div');
                agentNode.className = 'agent-node';
                agentNode.id = agent.id;
                agentNode.dataset.index = index;
                
                // 计算位置（基于世界地图的百分比位置）
                const position = agentPositions[agent.id];
                const x = (position.x / 100) * worldMapRect.width - 30;
                const y = (position.y / 100) * worldMapRect.height - 30;
                
                agentNode.style.left = `${x}px`;
                agentNode.style.top = `${y}px`;
                
                agentNode.innerHTML = `
                    <div class="agent-icon">
                        <img src="${agent.icon}" alt="${agent.name}" style="width: 40px; height: 40px; object-fit: contain;">
                    </div>
                    <div class="agent-name">${agent.name}</div>
                `;
                
                agentNode.addEventListener('click', () => selectAgent(index, agent));
                container.appendChild(agentNode);
            });
            
            // 绘制连接线
            drawConnectionLines();
        }

        // 绘制连接线
        function drawConnectionLines(showAll = false) {
            const svgContainer = document.getElementById('connectionSvg');
            const earthContainer = document.querySelector('.earth-container');
            const earthRect = earthContainer.getBoundingClientRect();
            
            // 清除现有连接线
            const existingPaths = svgContainer.querySelectorAll('.connection-path');
            existingPaths.forEach(path => path.remove());
            
            // 如果连接线不可见且不强制显示，则不绘制
            if (!connectionLinesVisible && !showAll) {
                return;
            }
            
            // 确定要绘制的连接
            let connectionsToDraw = connections;
            if (!showAll && selectedSender && selectedReceiver) {
                // 只绘制选中的连接
                connectionsToDraw = connections.filter(conn => 
                    (conn.from === selectedSender.index && conn.to === selectedReceiver.index) ||
                    (conn.from === selectedReceiver.index && conn.to === selectedSender.index)
                );
            }
            
            connectionsToDraw.forEach(connection => {
                const fromNode = document.querySelector(`[data-index="${connection.from}"]`);
                const toNode = document.querySelector(`[data-index="${connection.to}"]`);
                
                if (fromNode && toNode) {
                    const fromRect = fromNode.getBoundingClientRect();
                    const toRect = toNode.getBoundingClientRect();
                    
                    // 计算连接线位置
                    const fromCenter = {
                        x: fromRect.left + fromRect.width / 2 - earthRect.left,
                        y: fromRect.top + fromRect.height / 2 - earthRect.top
                    };
                    
                    const toCenter = {
                        x: toRect.left + toRect.width / 2 - earthRect.left,
                        y: toRect.top + toRect.height / 2 - earthRect.top
                    };
                    
                    // 根据连接的Agent生成对应的CSS类名
                    const fromAgent = agents[connection.from];
                    const toAgent = agents[connection.to];
                    const connectionClass = fromAgent && toAgent ? 
                        `${fromAgent.name.toLowerCase()}-${toAgent.name.toLowerCase()}` : 'normal';
                    
                    // 创建SVG路径
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.className = `connection-path ${connectionClass} normal`;
                    path.dataset.from = connection.from;
                    path.dataset.to = connection.to;
                    
                    // 调试信息
                    console.log('Creating path with class:', path.className);
                    console.log('From agent:', fromAgent.name, 'To agent:', toAgent.name);
                    
                    // 智能路径规划算法 - 减少重叠
                    const dx = toCenter.x - fromCenter.x;
                    const dy = toCenter.y - fromCenter.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // 计算连接的角度
                    const angle = Math.atan2(dy, dx);
                    const angleDegrees = (angle * 180 / Math.PI + 360) % 360;
                    
                    // 根据角度和距离智能分配路径层
                    let pathLayer = 0;
                    if (angleDegrees >= 0 && angleDegrees < 45) {
                        pathLayer = 0; // 水平向右
                    } else if (angleDegrees >= 45 && angleDegrees < 90) {
                        pathLayer = 1; // 右下
                    } else if (angleDegrees >= 90 && angleDegrees < 135) {
                        pathLayer = 2; // 垂直向下
                    } else if (angleDegrees >= 135 && angleDegrees < 180) {
                        pathLayer = 3; // 左下
                    } else if (angleDegrees >= 180 && angleDegrees < 225) {
                        pathLayer = 4; // 水平向左
                    } else if (angleDegrees >= 225 && angleDegrees < 270) {
                        pathLayer = 5; // 左上
                    } else if (angleDegrees >= 270 && angleDegrees < 315) {
                        pathLayer = 6; // 垂直向上
                    } else {
                        pathLayer = 7; // 右上
                    }
                    
                    // 根据连接索引和路径层计算偏移
                    const connectionId = Math.min(connection.from, connection.to) * 10 + Math.max(connection.from, connection.to);
                    const layerOffset = (connectionId % 3) - 1; // -1, 0, 1
                    
                    // 基础曲线强度
                    const baseCurveStrength = Math.min(distance * 0.15, 60);
                    
                    // 根据路径层和偏移计算最终曲线强度
                    const curveStrength = baseCurveStrength + (layerOffset * 20);
                    
                    // 计算垂直方向的偏移
                    const perpX = -dy / distance * curveStrength;
                    const perpY = dx / distance * curveStrength;
                    
                    // 智能控制点位置 - 根据路径层调整
                    const controlOffset1 = 0.2 + (pathLayer % 3) * 0.1; // 0.2, 0.3, 0.4
                    const controlOffset2 = 0.8 - (pathLayer % 3) * 0.1; // 0.8, 0.7, 0.6
                    
                    const control1X = fromCenter.x + dx * controlOffset1 + perpX;
                    const control1Y = fromCenter.y + dy * controlOffset1 + perpY;
                    const control2X = fromCenter.x + dx * controlOffset2 - perpX;
                    const control2Y = fromCenter.y + dy * controlOffset2 - perpY;
                    
                    // 创建贝塞尔曲线路径
                    const pathData = `M ${fromCenter.x} ${fromCenter.y} C ${control1X} ${control1Y}, ${control2X} ${control2Y}, ${toCenter.x} ${toCenter.y}`;
                    path.setAttribute('d', pathData);
                    
                    // 设置默认stroke属性 - 使用简单颜色测试
                    const colors = ['#667eea', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#a8edea', '#ffecd2', '#d299c2', '#89f7fe', '#fdbb2d', '#ff9a9e'];
                    const colorIndex = (connection.from + connection.to) % colors.length;
                    path.setAttribute('stroke', colors[colorIndex]);
                    path.setAttribute('stroke-width', '1.5');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('opacity', '0.6');
                    
                    svgContainer.appendChild(path);
                }
            });
        }

        // 选择Agent
        function selectAgent(index, agent) {
            if (selectedSender === null) {
                // 选择发送方
                selectedSender = { index, agent };
                updateAgentDisplay(index, 'selected-sender');
                updateSelectionDisplay();
                // 如果有接收方，显示连接线并高亮；否则隐藏所有连接线
                if (selectedReceiver) {
                    connectionLinesVisible = true;
                    drawConnectionLines(false); // 只显示选中的连接
                    highlightConnection(index, selectedReceiver.index);
                } else {
                    connectionLinesVisible = false;
                    clearHighlightedConnections();
                }
            } else if (selectedReceiver === null && selectedSender.index !== index) {
                // 选择接收方
                selectedReceiver = { index, agent };
                updateAgentDisplay(index, 'selected-receiver');
                updateSelectionDisplay();
                // 显示连接线并高亮选中的连接
                connectionLinesVisible = true;
                drawConnectionLines(false); // 只显示选中的连接
                highlightConnection(selectedSender.index, index);
                enableStartButton();
            } else if (selectedSender && selectedSender.index === index) {
                // 取消选择发送方
                console.log('Cancelling sender selection');
                selectedSender = null;
                updateAgentDisplay(index, '');
                updateSelectionDisplay();
                // 如果没有接收方，隐藏所有连接线
                if (!selectedReceiver) {
                    connectionLinesVisible = false;
                clearHighlightedConnections();
                } else {
                    // 隐藏所有连接线，因为只剩一个Agent被选中
                    connectionLinesVisible = false;
                    clearHighlightedConnections();
                }
            } else if (selectedReceiver && selectedReceiver.index === index) {
                // 取消选择接收方
                console.log('Cancelling receiver selection');
                selectedReceiver = null;
                updateAgentDisplay(index, '');
                updateSelectionDisplay();
                // 如果没有发送方，隐藏所有连接线
                if (!selectedSender) {
                    connectionLinesVisible = false;
                clearHighlightedConnections();
                } else {
                    // 隐藏所有连接线，因为只剩一个Agent被选中
                    connectionLinesVisible = false;
                clearHighlightedConnections();
                }
            }
        }

        // 更新Agent显示状态
        function updateAgentDisplay(index, className) {
            const agentNode = document.querySelector(`[data-index="${index}"]`);
            if (agentNode) {
                // 移除所有选择类
                agentNode.classList.remove('selected-sender', 'selected-receiver');
                // 添加新的选择类
                if (className) {
                    agentNode.classList.add(className);
                }
            }
        }

        // 更新选择信息显示
        function updateSelectionDisplay() {
            const senderBadge = document.getElementById('senderBadge');
            const receiverBadge = document.getElementById('receiverBadge');
            
            // 更新发送方角标显示
            if (selectedSender) {
                senderBadge.style.display = 'flex';
                senderBadge.querySelector('.agent-name').textContent = selectedSender.agent.name;
            } else {
                senderBadge.style.display = 'none';
            }
            
            // 更新接收方角标显示
            if (selectedReceiver) {
                receiverBadge.style.display = 'flex';
                receiverBadge.querySelector('.agent-name').textContent = selectedReceiver.agent.name;
            } else {
                receiverBadge.style.display = 'none';
            }
            
            // 更新底部面板统计
            updateDemoStats();
        }
        
        // 更新演示统计
        function updateDemoStats() {
            const covertMessages = document.getElementById('covertMessages');
            const successRate = document.getElementById('successRate');
            const detectionRate = document.getElementById('detectionRate');
            
            if (selectedSender && selectedReceiver) {
                // 模拟统计数据
                covertMessages.textContent = '1';
                successRate.textContent = '95%';
                detectionRate.textContent = '5%';
            } else {
                covertMessages.textContent = '0';
                successRate.textContent = '0%';
                detectionRate.textContent = '0%';
            }
        }

        // 高亮连接线
        function highlightConnection(fromIndex, toIndex) {
            // 先清除所有高亮
            clearHighlightedConnections();
            
            if (fromIndex !== null && toIndex !== null) {
                // 查找对应的连接线（双向查找）
                const path = document.querySelector(`[data-from="${fromIndex}"][data-to="${toIndex}"]`) ||
                            document.querySelector(`[data-from="${toIndex}"][data-to="${fromIndex}"]`);
                
                if (path) {
                    console.log('Highlighting connection between', fromIndex, 'and', toIndex);
                    path.classList.remove('normal');
                    path.classList.add('highlighted');
                    
                    // 设置高亮时的特殊属性
                    path.setAttribute('stroke-width', '3');
                    path.setAttribute('opacity', '1');
                } else {
                    console.log('Connection path not found between', fromIndex, 'and', toIndex);
                }
            }
        }

        // 清除高亮连接线
        function clearHighlightedConnections() {
            // 完全重新绘制连接线来清除所有高亮
            const svgContainer = document.getElementById('connectionSvg');
            if (svgContainer) {
                // 清除所有现有路径
                svgContainer.innerHTML = `
                    <defs>
                        <!-- 完整渐变定义 - 所有连接 -->
                        <linearGradient id="nexus-atlas-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-phoenix-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="nexus-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="atlas-phoenix-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="atlas-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="atlas-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="atlas-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="atlas-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="atlas-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="phoenix-sentinel-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="phoenix-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="phoenix-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="phoenix-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="phoenix-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="sentinel-orion-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="sentinel-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="sentinel-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="sentinel-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="orion-frost-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="orion-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="orion-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a8edea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fed6e3;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="frost-titan-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#d299c2;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fef9d7;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="frost-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#89f7fe;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#66a6ff;stop-opacity:1" />
                        </linearGradient>
                        
                        <linearGradient id="titan-nova-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fdbb2d;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#22c1c3;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                `;
                
                // 重新绘制所有连接线
                drawConnectionLines();
            }
            console.log('All connection highlights cleared by redrawing');
        }

        // 启用开始按钮
        function enableStartButton() {
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = false;
        }

        // 重置选择
        function resetSelection() {
            // 清除所有选择状态
            if (selectedSender) {
                updateAgentDisplay(selectedSender.index, '');
            }
            if (selectedReceiver) {
                updateAgentDisplay(selectedReceiver.index, '');
            }
            
            selectedSender = null;
            selectedReceiver = null;
            
            // 隐藏所有连接线
            connectionLinesVisible = false;
            
            // 更新显示
            updateSelectionDisplay();
            
            // 强制清除高亮
            clearHighlightedConnections();
            
            // 延迟再次清除，确保完全清除
            setTimeout(() => {
                clearHighlightedConnections();
            }, 100);
            
            // 禁用开始按钮
            document.getElementById('startBtn').disabled = true;
        }

        // 开始隐蔽通信
        function startCovertCommunication() {
            if (!selectedSender || !selectedReceiver) {
                alert('请先选择发送方和接收方');
                return;
            }
            
            // 保存选择信息到localStorage，供demo.html使用
            const selectionData = {
                sender: selectedSender.agent,
                receiver: selectedReceiver.agent,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('covertCommunicationSelection', JSON.stringify(selectionData));
            
            // 跳转到demo.html页面
            window.location.href = 'demo.html';
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟初始化以确保容器已渲染
            setTimeout(() => {
            initializeTopology();
                // 确保初始状态没有高亮
                clearHighlightedConnections();
            }, 100);
            
            // 窗口大小改变时重新绘制连接线
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    // 清除现有连接线
                    const linesContainer = document.getElementById('connectionLines');
                    linesContainer.innerHTML = '';
                    // 重新绘制
                    drawConnectionLines();
                }, 100);
            });
        });
    </script>
</body>
</html> 