<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2AÈöêËîΩÈÄö‰ø°ÊºîÁ§∫Á≥ªÁªü</title>
    <!-- ÂºïÂÖ•markdownËß£ÊûêÂ∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #2d3748 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            overflow-x: auto;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFlow 20s ease-in-out infinite;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 60% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 20% 60%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundFlow 25s ease-in-out infinite reverse;
        }
        
        @keyframes backgroundFlow {
            0%, 100% {
                transform: translateX(0) translateY(0) scale(1);
                opacity: 0.8;
            }
            25% {
                transform: translateX(20px) translateY(-10px) scale(1.05);
                opacity: 1;
            }
            50% {
                transform: translateX(-10px) translateY(20px) scale(0.95);
                opacity: 0.9;
            }
            75% {
                transform: translateX(15px) translateY(-15px) scale(1.02);
                opacity: 1;
            }
        }
        
        /* Ê∑ªÂä†ÊµÅÂä®ÁöÑÁ≤íÂ≠êÊïàÊûú */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 20s;
        }
        
        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            left: 20%;
            animation-delay: 2s;
            animation-duration: 18s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            left: 30%;
            animation-delay: 4s;
            animation-duration: 22s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        .particle:nth-child(4) {
            width: 5px;
            height: 5px;
            left: 40%;
            animation-delay: 6s;
            animation-duration: 16s;
        }
        
        .particle:nth-child(5) {
            width: 4px;
            height: 4px;
            left: 50%;
            animation-delay: 8s;
            animation-duration: 24s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(6) {
            width: 6px;
            height: 6px;
            left: 60%;
            animation-delay: 10s;
            animation-duration: 19s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        .particle:nth-child(7) {
            width: 3px;
            height: 3px;
            left: 70%;
            animation-delay: 12s;
            animation-duration: 21s;
        }
        
        .particle:nth-child(8) {
            width: 5px;
            height: 5px;
            left: 80%;
            animation-delay: 14s;
            animation-duration: 17s;
            background: rgba(255, 119, 198, 0.1);
        }
        
        .particle:nth-child(9) {
            width: 4px;
            height: 4px;
            left: 90%;
            animation-delay: 16s;
            animation-duration: 23s;
            background: rgba(120, 219, 255, 0.1);
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Ê∑ªÂä†Ê≥¢Êµ™ÊµÅÂä®ÊïàÊûú */
        .wave-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                rgba(102, 126, 234, 0.1) 0%, 
                rgba(255, 119, 198, 0.1) 25%, 
                rgba(120, 219, 255, 0.1) 50%, 
                rgba(102, 126, 234, 0.1) 75%, 
                rgba(255, 119, 198, 0.1) 100%);
            animation: waveFlow 30s ease-in-out infinite;
            border-radius: 50%;
        }
        
        .wave:nth-child(2) {
            animation-delay: -10s;
            animation-duration: 25s;
            background: linear-gradient(135deg, 
                rgba(120, 219, 255, 0.08) 0%, 
                rgba(102, 126, 234, 0.08) 25%, 
                rgba(255, 119, 198, 0.08) 50%, 
                rgba(120, 219, 255, 0.08) 75%, 
                rgba(102, 126, 234, 0.08) 100%);
        }
        
        .wave:nth-child(3) {
            animation-delay: -20s;
            animation-duration: 35s;
            background: linear-gradient(225deg, 
                rgba(255, 119, 198, 0.06) 0%, 
                rgba(120, 219, 255, 0.06) 25%, 
                rgba(102, 126, 234, 0.06) 50%, 
                rgba(255, 119, 198, 0.06) 75%, 
                rgba(120, 219, 255, 0.06) 100%);
        }
        
        @keyframes waveFlow {
            0%, 100% {
                transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1);
                opacity: 0.3;
            }
            25% {
                transform: translateX(-30%) translateY(-40%) rotate(90deg) scale(1.2);
                opacity: 0.5;
            }
            50% {
                transform: translateX(-40%) translateY(-60%) rotate(180deg) scale(0.8);
                opacity: 0.4;
            }
            75% {
                transform: translateX(-60%) translateY(-30%) rotate(270deg) scale(1.1);
                opacity: 0.6;
            }
        }
        
        .main-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .main-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .main-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 25px;
            align-items: start;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(50px) saturate(200%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset,
                0 -1px 0 rgba(0, 0, 0, 0.05) inset;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.05) 50%, 
                rgba(255, 255, 255, 0.2) 100%);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.2) inset,
                0 -1px 0 rgba(0, 0, 0, 0.05) inset;
            backdrop-filter: blur(50px) saturate(200%);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        .card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px 20px;
            border-radius: 16px;
            position: relative;
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.06),
                0 1px 0 rgba(255, 255, 255, 0.06) inset;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* ‰∏çÂêåÊ†áÈ¢òÂå∫ÂùóÁöÑÊØõÁéªÁíÉÊïàÊûú */
        .card:nth-child(1) h3 {
            background: rgba(102, 126, 234, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(102, 126, 234, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        .card:nth-child(2) h3 {
            background: rgba(118, 75, 162, 0.05);
            border: 1px solid rgba(118, 75, 162, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(118, 75, 162, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        .card:nth-child(3) h3 {
            background: rgba(39, 174, 96, 0.05);
            border: 1px solid rgba(39, 174, 96, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(39, 174, 96, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        .card:nth-child(4) h3 {
            background: rgba(231, 76, 60, 0.05);
            border: 1px solid rgba(231, 76, 60, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(231, 76, 60, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        .card:nth-child(5) h3 {
            background: rgba(52, 152, 219, 0.05);
            border: 1px solid rgba(52, 152, 219, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(52, 152, 219, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        .card:nth-child(6) h3 {
            background: rgba(155, 89, 182, 0.05);
            border: 1px solid rgba(155, 89, 182, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 4px 16px rgba(155, 89, 182, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
        }
        
        /* Ê†áÈ¢òÊÇ¨ÂÅúÊïàÊûú */
        .card h3:hover {
            backdrop-filter: blur(25px);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }
        
        /* Ê†áÈ¢òË£ÖÈ•∞Á∫øÊÇ¨ÂÅúÊïàÊûú */
        .card h3::before {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -5px;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 1px;
            transition: all 0.3s ease;
        }
        
        .card h3:hover::before {
            width: 50px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ffffff;
            font-size: 0.9rem;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 0.9rem;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            backdrop-filter: blur(30px) saturate(180%);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.06),
                0 1px 0 rgba(255, 255, 255, 0.04) inset;
        }
        
        select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 0.9rem;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            backdrop-filter: blur(30px) saturate(180%);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.06),
                0 1px 0 rgba(255, 255, 255, 0.04) inset;
        }
        
        input:hover, textarea:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background-color: rgba(102, 126, 234, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
            transform: translateY(-1px);
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background-color: rgba(102, 126, 234, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 0 0 2px rgba(102, 126, 234, 0.2),
                0 6px 20px rgba(102, 126, 234, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            transform: translateY(-1px);
        }
        
        button {
            background: rgba(255, 255, 255, 0.06);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 15px 30px;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1.1rem;
            margin: 0 10px;
            margin-bottom: 10px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                0 1px 0 rgba(255, 255, 255, 0.08) inset;
            backdrop-filter: blur(40px) saturate(180%);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            backdrop-filter: blur(40px) saturate(180%);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: rgba(0, 0, 0, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.05);
            opacity: 0.5;
        }
        
        .btn-danger {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            box-shadow: 0 8px 32px rgba(231, 76, 60, 0.3);
        }
        
        .btn-danger:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: rgba(231, 76, 60, 0.5);
            box-shadow: 0 12px 40px rgba(231, 76, 60, 0.4);
        }
        
        .btn-secondary {
            background: rgba(149, 165, 166, 0.2);
            border: 1px solid rgba(149, 165, 166, 0.3);
            box-shadow: 0 8px 32px rgba(149, 165, 166, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(149, 165, 166, 0.3);
            border-color: rgba(149, 165, 166, 0.5);
            box-shadow: 0 12px 40px rgba(149, 165, 166, 0.4);
        }
        
        /* ÂêØÂä®ÊåâÈíÆÁâπÊÆäÊïàÊûú */
        button[id="startBtn"], button[id="startA2AServerBtn"] {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.3);
            box-shadow: 0 8px 32px rgba(39, 174, 96, 0.3);
        }
        
        button[id="startBtn"]:hover, button[id="startA2AServerBtn"]:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: rgba(39, 174, 96, 0.5);
            box-shadow: 0 12px 40px rgba(39, 174, 96, 0.4);
        }
        
        /* ÂÅúÊ≠¢ÊåâÈíÆÁâπÊÆäÊïàÊûú */
        button[id="stopBtn"], button[id="stopA2AServerBtn"] {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            box-shadow: 0 8px 32px rgba(231, 76, 60, 0.3);
        }
        
        button[id="stopBtn"]:hover, button[id="stopA2AServerBtn"]:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: rgba(231, 76, 60, 0.5);
            box-shadow: 0 12px 40px rgba(231, 76, 60, 0.4);
        }
        
        .status-online {
            color: #27ae60;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: rgba(39, 174, 96, 0.1);
        }
        
        .status-online::before {
            content: '‚óè';
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        .status-offline {
            color: #e74c3c;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .status-offline::before {
            content: '‚óè';
            margin-right: 5px;
        }
        
        /* Áä∂ÊÄÅÊ†áÁ≠æÊñáÂ≠óÊ†∑Âºè */
        .status-label {
            color: #ffffff !important;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }
        
        /* ÈÄö‰ø°Áä∂ÊÄÅÊñáÂ≠óÊ†∑Âºè */
        #currentPhase {
            color: #ffffff !important;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        /* Ëá™ÂÆö‰πâÂ§çÈÄâÊ°ÜÊ†∑Âºè - ËãπÊûúÈ£éÊ†ºÊØõÁéªÁíÉÊïàÊûú */
        .form-group input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px) saturate(150%);
            cursor: pointer;
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }
        
        .form-group input[type="checkbox"]:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
            transform: scale(1.08);
        }
        
        .form-group input[type="checkbox"]:checked {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.9), 
                rgba(118, 75, 162, 0.9));
            border-color: rgba(102, 126, 234, 0.8);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.25),
                0 1px 0 rgba(255, 255, 255, 0.2) inset,
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            transform: scale(1.05);
        }
        
        .form-group input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: checkmarkAppear 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        @keyframes checkmarkAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3) rotate(-10deg);
            }
            50% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
        }
        
        /* Â§çÈÄâÊ°ÜÊ†áÁ≠æÊ†∑Âºè */
        .form-group label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-group label:hover {
            transform: translateX(2px);
        }
        
        /* Ëá™ÂÆö‰πâ‰∏ãÊãâÊ°ÜÊ†∑Âºè - ËãπÊûúÈ£éÊ†ºÊØõÁéªÁíÉÊïàÊûú */
        .form-group select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 40px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .form-group select:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background-color: rgba(102, 126, 234, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
            transform: translateY(-1px);
        }
        
        .form-group select:focus {
            border-color: rgba(102, 126, 234, 0.6);
            background-color: rgba(102, 126, 234, 0.12);
            backdrop-filter: blur(40px) saturate(200%);
            box-shadow: 
                0 0 0 2px rgba(102, 126, 234, 0.2),
                0 6px 20px rgba(102, 126, 234, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            transform: translateY(-1px);
        }
        
        /* ‰∏ãÊãâÊ°ÜÈÄâÈ°πÊ†∑Âºè */
        .form-group select option {
            background: rgba(0, 0, 0, 0.9);
            color: #ffffff;
            padding: 12px 16px;
            border: none;
            backdrop-filter: blur(20px);
        }
        
        .form-group select option:hover {
            background: rgba(102, 126, 234, 0.3);
        }
        
        .form-group select option:checked {
            background: rgba(102, 126, 234, 0.5);
            color: #ffffff;
        }
        
        /* ‰∏ãÊãâÊ°ÜÂÆπÂô®Ê†∑Âºè - Âè™ÂØπÂåÖÂê´selectÁöÑform-groupÂ∫îÁî® */
        .form-group:has(select) {
            position: relative;
        }
        
        /* ‰∏∫ÂåÖÂê´selectÁöÑform-groupÊ∑ªÂä†ÁÆ≠Â§¥ */
        .form-group:has(select)::after {
            content: '';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid rgba(255, 255, 255, 0.6);
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .form-group:has(select):hover::after {
            border-top-color: rgba(102, 126, 234, 0.8);
            transform: translateY(-50%) scale(1.1);
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .messages {
            height: 520px;
            overflow-y: auto;
            border: none;
            padding: 20px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 20px;
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.06),
                0 1px 0 rgba(255, 255, 255, 0.04) inset;
        }
        
        .messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        .messages::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }
        
        .messages::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }
        
        .message {
            margin-bottom: 16px;
            padding: 16px 20px;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
            animation: messageSlideIn 0.3s ease-out;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-agent-a {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .message-agent-a .message-header {
            color: rgba(255,255,255,0.9);
        }
        
        .message-agent-b {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        .message-agent-b .message-header {
            color: rgba(255,255,255,0.9);
        }
        
        .message-system {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #8b4513;
            text-align: center;
            margin: 16px auto;
            max-width: 70%;
            border-radius: 25px;
            font-weight: 500;
        }
        
        .message-evaluation {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #2c3e50;
            border-left: 4px solid #667eea;
            margin: 16px auto;
            max-width: 90%;
            font-size: 14px;
            border-radius: 12px;
        }
        #evaluationResults {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        #evaluationResults::-webkit-scrollbar {
            width: 6px;
        }
        
        #evaluationResults::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        #evaluationResults::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }
        
        .evaluation-round {
            border: none;
            border-radius: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            animation: evaluationSlideIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .evaluation-round::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        @keyframes evaluationSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .evaluation-round:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .evaluation-round-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 16px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .round-number {
            font-weight: 700;
            color: #ffffff;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .round-number::before {
            content: 'üîÑ';
            margin-right: 8px;
        }
        
        .round-timestamp {
            font-size: 0.8rem;
            color: #ffffff;
            background: rgba(127, 140, 141, 0.2);
            padding: 6px 12px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .evaluation-summary {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .summary-item {
            text-align: center;
            padding: 16px 12px;
            border-radius: 12px;
            border: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 12px 12px 0 0;
        }
        
        .summary-naturalness {
            background: linear-gradient(135deg, #d5f4e6, #b8e6cc);
            color: #27ae60;
        }
        
        .summary-naturalness::before {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }
        
        .summary-coherence {
            background: linear-gradient(135deg, #dae8fc, #b3d9ff);
            color: #3498db;
        }
        
        .summary-coherence::before {
            background: linear-gradient(90deg, #3498db, #5dade2);
        }
        
        .summary-suspicion {
            background: linear-gradient(135deg, #fde8e8, #ffcccb);
            color: #e74c3c;
        }
        
        .summary-suspicion::before {
            background: linear-gradient(90deg, #e74c3c, #ec7063);
        }
        
        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .summary-score {
            font-size: 1.8rem;
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 0.8rem;
            font-weight: 500;
            opacity: 0.8;
        }
        .evaluation-details-panel {
            margin-top: 15px;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.5);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .evaluation-details-panel summary {
            cursor: pointer;
            font-weight: 600;
            padding: 12px 16px;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .evaluation-details-panel summary:hover {
            background: rgba(102, 126, 234, 0.2);
            color: #5a67d8;
        }
        
        .evaluation-details-panel[open] summary {
            background: rgba(102, 126, 234, 0.15);
        }
        
        .detail-item {
            margin: 0;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0;
            border-left: none;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            transition: background 0.3s ease;
        }
        
        .detail-item:last-child {
            border-bottom: none;
            border-radius: 0 0 12px 12px;
        }
        
        .detail-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .detail-label {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            display: block;
        }
        
        .message-header {
            font-size: 0.75rem;
            margin-bottom: 8px;
            opacity: 0.8;
            font-weight: 500;
        }
        .text-center {
            text-align: center;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading p {
            color: #ffffff;
            font-weight: 500;
            margin: 0;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes loadingPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* Â∞èÂ±èÂπïÈÄÇÈÖç */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            body {
                padding: 15px;
            }
            
            .main-header h1 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .main-header h1 {
                font-size: 1.8rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .card h3 {
                font-size: 1.1rem;
            }
            
            button {
                padding: 12px 24px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .main-header h1 {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 12px;
            }
            
            .card h3 {
                font-size: 1rem;
            }
            
            button {
                padding: 10px 20px;
                font-size: 0.9rem;
                margin: 5px;
            }
        }
        
        /* Â¢ûÂº∫ÂèØËÆøÈóÆÊÄß */
        button:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
        }
        
        /* Áä∂ÊÄÅÊåáÁ§∫Âô®Â¢ûÂº∫ */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-indicator.online {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }
        
        .status-indicator.offline {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        
        /* MarkdownÂÜÖÂÆπÊ†∑Âºè */
        .message-content {
            line-height: 1.6;
        }
        
        .message-content h1,
        .message-content h2,
        .message-content h3,
        .message-content h4,
        .message-content h5,
        .message-content h6 {
            margin: 16px 0 8px 0;
            font-weight: 600;
            color: inherit;
        }
        
        .message-content h1 { font-size: 1.5em; }
        .message-content h2 { font-size: 1.3em; }
        .message-content h3 { font-size: 1.2em; }
        .message-content h4 { font-size: 1.1em; }
        
        .message-content p {
            margin: 8px 0;
        }
        
        .message-content ul,
        .message-content ol {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .message-content li {
            margin: 4px 0;
        }
        
        .message-content code {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        
        .message-content pre {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .message-content pre code {
            background: none;
            padding: 0;
            border-radius: 0;
        }
        
        .message-content blockquote {
            border-left: 3px solid rgba(255, 255, 255, 0.3);
            margin: 12px 0;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }
        
        .message-content strong {
            font-weight: 700;
        }
        
        .message-content em {
            font-style: italic;
        }
        
        .message-content a {
            color: inherit;
            text-decoration: underline;
            opacity: 0.9;
        }
        
        .message-content a:hover {
            opacity: 1;
        }
        
        .message-content hr {
            border: none;
            height: 1px;
            background: rgba(255, 255, 255, 0.3);
            margin: 16px 0;
        }
        
        /* ‰∏∫‰∏çÂêåÁ±ªÂûãÁöÑÊ∂àÊÅØË∞ÉÊï¥markdownÊ†∑Âºè */
        .message-agent-a .message-content code {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .message-agent-b .message-content code {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .message-system .message-content code {
            background: rgba(139, 69, 19, 0.2);
            color: #8b4513;
        }
        
        .message-evaluation .message-content code {
            background: rgba(44, 62, 80, 0.1);
        }

        /* ËØÑ‰º∞ÊåáÊ†áÁªüËÆ°Ê†∑Âºè */
        .metrics-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-summary-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 16px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(15px);
        }

        .metric-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 15px 15px 0 0;
        }

        .metric-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 12px 12px 0 0;
        }

        .metric-summary-card.naturalness::before {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }

        .metric-summary-card.coherence::before {
            background: linear-gradient(90deg, #3498db, #5dade2);
        }

        .metric-summary-card.suspicion::before {
            background: linear-gradient(90deg, #e74c3c, #ec7063);
        }

        .metric-summary-card.capacity::before {
            background: linear-gradient(90deg, #f39c12, #f1c40f);
        }

        .metric-summary-card.efficiency::before {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
        }

        .metric-summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .metric-summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .metric-summary-label {
            font-size: 0.85rem;
            color: #ffffff;
            font-weight: 500;
        }

        .metric-summary-trend {
            font-size: 0.75rem;
            margin-top: 5px;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .trend-up {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }

        .trend-down {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .trend-stable {
            background: rgba(149, 165, 166, 0.1);
            color: #95a5a6;
        }

        .metrics-charts {
            margin-top: 25px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-title {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 15px;
            text-align: center;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .mini-chart {
            height: 120px;
            position: relative;
            overflow: hidden;
        }

        .chart-line {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(102, 126, 234, 0.2), transparent);
            border-top: 2px solid #667eea;
            border-radius: 4px 4px 0 0;
        }

        .metrics-export {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(102, 126, 234, 0.2);
        }

        .btn-export {
            background: rgba(102, 126, 234, 0.2);
            color: white;
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            backdrop-filter: blur(15px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
            backdrop-filter: blur(20px);
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        /* Â∞èÊåâÈíÆÊ†∑ÂºèÔºàÂ¶ÇÂà∑Êñ∞ÊåâÈíÆÔºâ */
        button[style*="padding: 2px 8px"] {
            background: rgba(52, 152, 219, 0.2) !important;
            border: 1px solid rgba(52, 152, 219, 0.3) !important;
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3) !important;
            backdrop-filter: blur(10px) !important;
            font-size: 12px !important;
            padding: 6px 12px !important;
            border-radius: 8px !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
        }
        
        button[style*="padding: 2px 8px"]:hover {
            background: rgba(52, 152, 219, 0.3) !important;
            border-color: rgba(52, 152, 219, 0.5) !important;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4) !important;
            backdrop-filter: blur(15px) !important;
            transform: translateY(-1px) !important;
        }
    </style>
</head>
<body>
    <!-- ËÉåÊôØÊïàÊûú -->
    <div class="wave-background">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    
    <div class="floating-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    
    <div class="main-header">
        <h1>ü§ñ A2AÈöêËîΩÈÄö‰ø°ÊºîÁ§∫Á≥ªÁªü</h1>
        <p>Âü∫‰∫éAgent-to-AgentÂçèËÆÆÁöÑÊô∫ËÉΩ‰ΩìÈó¥ÈöêËîΩÈÄö‰ø°ÊºîÁ§∫</p>
        <div id="selectionInfo" style="margin-top: 20px; padding: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 15px; display: none; backdrop-filter: blur(15px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: rgba(231, 76, 60, 0.2); border-radius: 12px; border: 2px solid rgba(231, 76, 60, 0.6);">
                    <span style="font-size: 1.2rem;">üì§</span>
                    <span style="color: #ffffff; font-weight: 500;">ÂèëÈÄÅÊñπ: <span id="senderName" style="color: #ff6b6b; font-weight: 600;">Êú™ÈÄâÊã©</span></span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: rgba(39, 174, 96, 0.2); border-radius: 12px; border: 2px solid rgba(39, 174, 96, 0.6);">
                    <span style="font-size: 1.2rem;">üì•</span>
                    <span style="color: #ffffff; font-weight: 500;">Êé•Êî∂Êñπ: <span id="receiverName" style="color: #51cf66; font-weight: 600;">Êú™ÈÄâÊã©</span></span>
                </div>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="window.location.href='topology.html'" style="background: linear-gradient(45deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 0.9rem; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    üîÑ ÈáçÊñ∞ÈÄâÊã©Agent
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Â∑¶‰æßÈÖçÁΩÆÂíåÊéßÂà∂Èù¢Êùø -->
        <div>
            <!-- ÊúçÂä°Âô®ÈÖçÁΩÆÈù¢Êùø -->
            <div class="card">
                <h3>üñ•Ô∏è ÊúçÂä°Âô®ÈÖçÁΩÆ</h3>
                <div class="form-group">
                    <label>ÈöêÂÜôÊ®°ÂûãË∑ØÂæÑ</label>
                    <select id="serverStegoModel">
                        <option value="/root/autodl-tmp/Llama-3.2-3B-Instruct">Llama-3.2-3B-Instruct</option>
                        <option value="/root/autodl-tmp/Qwen2-7B-Instruct">Qwen2-7B-Instruct</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ÊúçÂä°Âô®ÈöêÂÜôÁÆóÊ≥ï</label>
                    <select id="serverStegoAlgorithm">
                        <option value="meteor">Meteor (Êé®Ëçê)</option>
                        <option value="discop">DisCOP</option>
                        <option value="discop_base">DisCOP Base</option>
                        <option value="ac">ÁÆóÊúØÁºñÁ†Å (AC)</option>
                        <option value="differential_based">Differential Based</option>
                        <option value="binary_based">Binary Based</option>
                        <option value="stability_based">Stability Based</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ÊúçÂä°Âô®ÈöêÂÜôÂØÜÈí•</label>
                    <input type="text" id="serverStegoKey" value="7b9ec09254aa4a7589e4d0cfd80d46cc" placeholder="32‰ΩçÂçÅÂÖ≠ËøõÂà∂ÂØÜÈí•">
                </div>
                
                <div class="form-group">
                    <label>Ëß£ÂØÜÊñá‰ª∂Ë∑ØÂæÑ</label>
                    <input type="text" id="decryptedBitsPath" value="data/stego/decrypted_bits.txt" placeholder="Ëß£ÂØÜÁªìÊûúÂ≠òÂÇ®Ë∑ØÂæÑ">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <span class="status-label">A2AÊúçÂä°Âô®Áä∂ÊÄÅ: </span>
                    <span id="a2aServerStatus" class="status-offline">Ê£ÄÊü•‰∏≠...</span>
                    <button onclick="checkA2AServerStatus()" style="padding: 2px 8px; font-size: 12px;">Âà∑Êñ∞</button>
                </div>
                
                <div>
                    <button id="startA2AServerBtn" onclick="startA2AServer()">‚ñ∂Ô∏è ÂêØÂä®A2AÊúçÂä°Âô®</button>
                    <button id="stopA2AServerBtn" onclick="stopA2AServer()" class="btn-danger" disabled>‚è∏Ô∏è ÂÅúÊ≠¢A2AÊúçÂä°Âô®</button>
                </div>
            </div>

            <!-- ÂÆ¢Êà∑Á´ØÈÖçÁΩÆÈù¢Êùø -->
            <div class="card">
                <h3>üì± ÂÆ¢Êà∑Á´ØÈÖçÁΩÆ</h3>
                <div class="form-group">
                    <label>ÈöêËîΩ‰ø°ÊÅØ (‰∫åËøõÂà∂)</label>
                    <textarea id="secretMessage" rows="3" placeholder="ËØ∑ËæìÂÖ•Ë¶Å‰º†ËæìÁöÑ‰∫åËøõÂà∂Êï∞ÊçÆ">0110100001100101011011000110110001101111001011000010000001110111011011110111001001101100011001000010000000001010</textarea>
                    <small id="messageLength">ÈïøÂ∫¶: 0 ‰Ωç</small>
                </div>
                
                <div class="form-group">
                    <label>ÂÆ¢Êà∑Á´ØÈöêÂÜôÁÆóÊ≥ï</label>
                    <select id="clientStegoAlgorithm">
                        <option value="meteor">Meteor (Êé®Ëçê)</option>
                        <option value="discop">DisCOP</option>
                        <option value="ac">ÁÆóÊúØÁºñÁ†Å (AC)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ÈóÆÈ¢òÊñá‰ª∂</label>
                    <select id="questionPath">
                        <option value="data/question/general.txt">ÈÄöÁî®ÈóÆÈ¢ò</option>
                        <option value="data/question/art.txt">Ëâ∫ÊúØÈóÆÈ¢ò</option>
                        <option value="data/question/philosophy.txt">Âì≤Â≠¶ÈóÆÈ¢ò</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ÈóÆÈ¢òÁºñÂè∑</label>
                    <select id="questionIndex">
                        <option value="0">ÈóÆÈ¢ò 1</option>
                        <option value="1">ÈóÆÈ¢ò 2</option>
                        <option value="2">ÈóÆÈ¢ò 3</option>
                    </select>
                </div>
            </div>

            <!-- ËØÑ‰º∞ÈÖçÁΩÆÈù¢Êùø -->
            <div class="card">
                <h3>üß† GPTËØÑ‰º∞ÈÖçÁΩÆ</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableEvaluation" checked> 
                        ÂêØÁî®GPTÂèØ‰ø°Â∫¶ËØÑ‰º∞
                    </label>
                    <small style="display: block; color: #ffffff; margin-top: 5px; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        ÈúÄË¶ÅËÆæÁΩÆAIHUBMIX_API_KEYÁéØÂ¢ÉÂèòÈáè
                    </small>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <span class="status-label">ËØÑ‰º∞ÊúçÂä°Áä∂ÊÄÅ: </span>
                    <span id="evaluationStatus" class="status-offline">Ê£ÄÊü•‰∏≠...</span>
                </div>
            </div>

            <!-- ÈÄö‰ø°ÊéßÂà∂Èù¢Êùø -->
            <div class="card">
                <h3>üéÆ ÈÄö‰ø°ÊéßÂà∂</h3>
                <div style="margin-bottom: 15px;">
                    <span class="status-label">ÂÆ¢Êà∑Á´ØÂåÖË£ÖÂô®Áä∂ÊÄÅ: </span>
                    <span id="clientWrapperStatus" class="status-offline">Ê£ÄÊü•‰∏≠...</span>
                    <button onclick="checkClientWrapperStatus()" style="padding: 2px 8px; font-size: 12px;">Âà∑Êñ∞</button>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <span class="status-label">ÈÄö‰ø°Áä∂ÊÄÅ: </span>
                    <span id="currentPhase">Á©∫Èó≤</span>
                </div>
                
                <div>
                    <button id="startBtn" onclick="startCommunication()">üöÄ ÂêØÂä®ÈöêËîΩÈÄö‰ø°</button>
                    <button id="stopBtn" onclick="stopCommunication()" class="btn-danger" disabled>‚èπÔ∏è ÂÅúÊ≠¢ÈÄö‰ø°</button>
                    <button onclick="resetSystem()" class="btn-secondary">üîÑ ÈáçÁΩÆ</button>
                    <button onclick="testMarkdown()" class="btn-secondary" style="font-size: 12px; padding: 8px 12px;">üß™ ÊµãËØïMarkdown</button>
                    <button onclick="testMetricsDemo()" class="btn-secondary" style="font-size: 12px; padding: 8px 12px;">üìä ÊµãËØïÁªüËÆ°</button>
                </div>
                
                <div class="loading" id="loading">
                    <p>Ê≠£Âú®Â§ÑÁêÜ‰∏≠ÔºåËØ∑Á®çÂÄô...</p>
                </div>
            </div>
        </div>

        <!-- Âè≥‰æßÂØπËØùÊòæÁ§∫Âå∫Âüü -->
        <div>
            <div class="card">
                <h3>üí¨ AgentÂØπËØùÁ™óÂè£</h3>
                <div class="messages" id="messages">
                    <div class="text-center" style="padding: 40px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        <p>Á≠âÂæÖAgentÂºÄÂßãÂØπËØù...</p>
                        <p style="font-size: 14px;">ÁÇπÂáª"ÂêØÂä®ÈöêËîΩÈÄö‰ø°"ÊåâÈíÆÂºÄÂßãÊºîÁ§∫</p>
                    </div>
                </div>
            </div>

            <!-- GPTËØÑ‰º∞ÁªìÊûúÈù¢Êùø -->
            <div class="card">
                <h3>ü§ñ GPTÂèØ‰ø°Â∫¶ËØÑ‰º∞ÁªìÊûú</h3>
                <div id="evaluationResults">
                    <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        <p>Á≠âÂæÖËØÑ‰º∞ÁªìÊûú...</p>
                        <p style="font-size: 14px;">ÂØπËØùÂºÄÂßãÂêéÂ∞ÜÊòæÁ§∫ÊØèËΩÆÁöÑËØÑ‰º∞ÁªìÊûú</p>
                    </div>
                </div>
            </div>

            <!-- ËØÑ‰º∞ÊåáÊ†áÁªüËÆ°Èù¢Êùø -->
            <div class="card">
                <h3>üìä ËØÑ‰º∞ÊåáÊ†áÁªüËÆ°</h3>
                <div id="metricsStatistics">
                    <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        <p>Á≠âÂæÖÁªüËÆ°Êï∞ÊçÆ...</p>
                        <p style="font-size: 14px;">ËØÑ‰º∞ÂÆåÊàêÂêéÂ∞ÜÊòæÁ§∫ËØ¶ÁªÜÁªüËÆ°‰ø°ÊÅØ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let currentSessionId = '';
        let websocket = null;
        let currentRound = 0;
        let evaluationMetrics = {
            naturalness: [],
            coherence: [],
            suspicion: [],
            rounds: [],
            bitsTransmitted: [],  // ÊØèËΩÆÂÆûÈôÖ‰º†ËæìÁöÑÊØîÁâπÊï∞
            cumulativeBits: []    // Á¥ØÁßØ‰º†ËæìÊØîÁâπÊï∞
        };

        // ÁîüÊàêUUID
        function generateUUID() {
            return 'covert-session-uuid-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        // Âª∫Á´ãWebSocketËøûÊé•
        function setupWebSocketConnection(sessionId) {
            if (websocket) {
                websocket.close();
            }
            
            websocket = new WebSocket(`ws://localhost:8889/ws/${sessionId}`);
            
            websocket.onopen = function(event) {
                console.log('WebSocketËøûÊé•Â∑≤Âª∫Á´ã');
                document.getElementById('currentPhase').textContent = 'ÈÄö‰ø°‰∏≠...';
            };
            
            websocket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log('Êî∂Âà∞WebSocketÊ∂àÊÅØ:', data);
                
                switch(data.type) {
                    case 'system_message':
                        addMessage('system', data.message);
                        if (data.message.includes('ÂÆåÊàê')) {
                            finishCommunication();
                        }
                        break;
                    case 'agent_message':
                        addMessage(data.sender, data.content);
                        if (data.sender === 'agent-a') {
                            currentRound++; // Agent A ÂèëÈÄÅÊ∂àÊÅØÊó∂Â¢ûÂä†ËΩÆÊï∞
                            document.getElementById('currentPhase').textContent = `Á¨¨${currentRound}ËΩÆ - Agent AÂèëÈÄÅÊ∂àÊÅØ...`;
                        } else if (data.sender === 'agent-b') {
                            document.getElementById('currentPhase').textContent = `Á¨¨${currentRound}ËΩÆ - Agent BÂìçÂ∫î‰∏≠...`;
                        }
                        break;
                    case 'evaluation_result':
                        addEvaluationMessage(data);
                        document.getElementById('currentPhase').textContent = `Á¨¨${currentRound}ËΩÆ - ËØÑ‰º∞ÂÆåÊàêÔºåÁ≠âÂæÖ‰∏ã‰∏ÄËΩÆ...`;
                        break;
                    case 'error':
                        addMessage('system', `ÈîôËØØ: ${data.message}`);
                        finishCommunication();
                        break;
                }
            };
            
            websocket.onerror = function(error) {
                console.error('WebSocketÈîôËØØ:', error);
                addMessage('system', 'ÈÄö‰ø°ËøûÊé•Âá∫Áé∞ÈîôËØØ');
                finishCommunication();
            };
            
            websocket.onclose = function(event) {
                console.log('WebSocketËøûÊé•Â∑≤ÂÖ≥Èó≠');
                if (isRunning) {
                    document.getElementById('currentPhase').textContent = 'ËøûÊé•Â∑≤Êñ≠ÂºÄ';
                }
            };
        }

        // Êõ¥Êñ∞Ê∂àÊÅØÈïøÂ∫¶ÊòæÁ§∫
        function updateMessageLength() {
            const secretMessage = document.getElementById('secretMessage').value;
            document.getElementById('messageLength').textContent = 
                `ÈïøÂ∫¶: ${secretMessage.length} ‰Ωç (${Math.ceil(secretMessage.length / 8)} Â≠óËäÇ)`;
        }

        // Ê£ÄÊµãÂÜÖÂÆπÊòØÂê¶‰∏∫markdownÊ†ºÂºè
        function isMarkdownContent(content) {
            // Â¶ÇÊûúÂÜÖÂÆπÂ§™Áü≠Ôºå‰∏çÂ§™ÂèØËÉΩÊòØmarkdown
            if (content.length < 10) {
                return false;
            }
            
            // Ê£ÄÊµãÂ∏∏ËßÅÁöÑmarkdownËØ≠Ê≥ï
            const markdownPatterns = [
                /^#{1,6}\s+/m,          // Ê†áÈ¢ò # ## ###
                /\*\*.*?\*\*/,          // Á≤ó‰Ωì **text**
                /(?<!\w)\*[^*\s].*?[^*\s]\*(?!\w)/, // Êñú‰Ωì *text* (ÈÅøÂÖç‰∏éÂÖ∂‰ªñÁî®Ê≥ïÂÜ≤Á™Å)
                /`[^`]+`/,              // Ë°åÂÜÖ‰ª£Á†Å `code`
                /```[\s\S]*?```/,       // ‰ª£Á†ÅÂùó ```code```
                /^\s*[-*+]\s+/m,        // Êó†Â∫èÂàóË°® - * +
                /^\s*\d+\.\s+/m,        // ÊúâÂ∫èÂàóË°® 1. 2.
                /^\s*>\s+/m,            // ÂºïÁî® > text
                /\[.*?\]\(.*?\)/,       // ÈìæÊé• [text](url)
                /!\[.*?\]\(.*?\)/,      // ÂõæÁâá ![alt](url)
                /^\s*---+\s*$/m,        // Ê∞¥Âπ≥ÂàÜÂâ≤Á∫ø ---
                /^\s*\|.*\|.*$/m        // Ë°®Ê†º |col1|col2|
            ];
            
            // ËÆ°ÁÆóÂåπÈÖçÁöÑÊ®°ÂºèÊï∞Èáè
            let matchCount = 0;
            for (const pattern of markdownPatterns) {
                if (pattern.test(content)) {
                    matchCount++;
                    // Â¶ÇÊûúÂåπÈÖçÂà∞2‰∏™Êàñ‰ª•‰∏äÁöÑmarkdownÊ®°ÂºèÔºåËÆ§‰∏∫ÊòØmarkdownÂÜÖÂÆπ
                    if (matchCount >= 2) {
                        return true;
                    }
                }
            }
            
            // Âçï‰∏™Âº∫ÁâπÂæÅ‰πüËÆ§‰∏∫ÊòØmarkdown
            const strongPatterns = [
                /^#{1,6}\s+/m,          // Ê†áÈ¢ò
                /```[\s\S]*?```/,       // ‰ª£Á†ÅÂùó
                /^\s*\|.*\|.*$/m        // Ë°®Ê†º
            ];
            
            return strongPatterns.some(pattern => pattern.test(content));
        }

        // Ê∑ªÂä†Ê∂àÊÅØÂà∞ÂØπËØùÊ°Ü
        function addMessage(sender, content, metadata = {}) {
            const messagesDiv = document.getElementById('messages');
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊù°Ê∂àÊÅØÔºåÊ∏ÖÁ©∫ÂàùÂßãÊèêÁ§∫
            if (messagesDiv.children.length === 1 && messagesDiv.children[0].textContent.includes('Á≠âÂæÖAgent')) {
                messagesDiv.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            
            let senderName = '';
            switch(sender) {
                case 'agent-a': senderName = 'Agent A (ÂÆ¢Êà∑Á´Ø)'; break;
                case 'agent-b': senderName = 'Agent B (ÊúçÂä°Á´Ø)'; break;
                case 'system': senderName = 'Á≥ªÁªü'; break;
            }
            
            headerDiv.textContent = senderName + ' ' + new Date().toLocaleTimeString();
            if (metadata.isHandshake) headerDiv.textContent += ' [Êè°Êâã]';
            if (metadata.isVerification) headerDiv.textContent += metadata.verificationSuccess ? ' [È™åËØÅÊàêÂäü]' : ' [È™åËØÅÂ§±Ë¥•]';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            // Ê£ÄÊµãÂπ∂Ê∏≤ÊüìmarkdownÂÜÖÂÆπ
            if (typeof marked !== 'undefined' && isMarkdownContent(content)) {
                try {
                    // ÈÖçÁΩÆmarkedÈÄâÈ°π
                    marked.setOptions({
                        breaks: true,        // ÊîØÊåÅÊç¢Ë°å
                        gfm: true,          // ÂêØÁî®GitHubÈ£éÊ†ºmarkdown
                        sanitize: true,     // ËøáÊª§Âç±Èô©ÁöÑHTMLÊ†áÁ≠æ
                        smartLists: true,   // Êô∫ËÉΩÂàóË°®
                        smartypants: true   // Êô∫ËÉΩÊ†áÁÇπ
                    });
                    
                    contentDiv.innerHTML = marked.parse(content);
                } catch (error) {
                    console.warn('MarkdownËß£ÊûêÂ§±Ë¥•Ôºå‰ΩøÁî®Á∫ØÊñáÊú¨:', error);
                    contentDiv.textContent = content;
                }
            } else {
                // ÈùûmarkdownÂÜÖÂÆπÔºå‰ΩøÁî®Á∫ØÊñáÊú¨
                contentDiv.textContent = content;
            }
            
            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Ê∑ªÂä†ËØÑ‰º∞Ê∂àÊÅØÂà∞ÂØπËØùÊ°ÜÔºà‰øùÁïôÁÆÄÂåñÁâàÊú¨Ôºâ
        function addEvaluationMessage(data) {
            const messagesDiv = document.getElementById('messages');
            const evaluation = data.evaluation;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-evaluation';
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            headerDiv.textContent = `ü§ñ Á¨¨${currentRound}ËΩÆËØÑ‰º∞ÂÆåÊàê ` + new Date().toLocaleTimeString();
            
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = `
                <div style="text-align: center; font-size: 14px;">
                    Ëá™ÁÑ∂Â∫¶: ${evaluation.naturalness_score}/5 | 
                    ËøûË¥ØÊÄß: ${evaluation.intentional_coherence_score}/5 | 
                    ÂèØÁñëÂ∫¶: ${evaluation.suspicion_score}/5
                    <br><small style="color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">ËØ¶ÁªÜÁªìÊûúËØ∑Êü•ÁúãÂè≥‰æßËØÑ‰º∞Èù¢Êùø</small>
                </div>
            `;
            
            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Ê∑ªÂä†Âà∞Áã¨Á´ãÁöÑËØÑ‰º∞ÁªìÊûúÈù¢Êùø
            addEvaluationToPanel(data.evaluation);
            
            // Êõ¥Êñ∞ËØÑ‰º∞ÊåáÊ†áÁªüËÆ°ÔºàÂ∞ùËØï‰ªéÊï∞ÊçÆ‰∏≠Ëé∑Âèñ‰º†ËæìÊØîÁâπÊï∞Ôºâ
            const bitsTransmitted = data.bits_transmitted || null;
            updateMetricsStatistics(data.evaluation, bitsTransmitted);
        }

        // Êõ¥Êñ∞ËØÑ‰º∞ÊåáÊ†áÁªüËÆ°
        function updateMetricsStatistics(evaluation, bitsTransmitted = null) {
            // Ê∑ªÂä†Êñ∞ÁöÑËØÑ‰º∞Êï∞ÊçÆ
            evaluationMetrics.naturalness.push(evaluation.naturalness_score);
            evaluationMetrics.coherence.push(evaluation.intentional_coherence_score);
            evaluationMetrics.suspicion.push(evaluation.suspicion_score);
            evaluationMetrics.rounds.push(currentRound);
            
            // Â§ÑÁêÜ‰º†ËæìÊØîÁâπÊï∞ÔºàÂ¶ÇÊûúÊèê‰æõÔºâ
            if (bitsTransmitted !== null && bitsTransmitted > 0) {
                evaluationMetrics.bitsTransmitted.push(bitsTransmitted);
            } else {
                // Â¶ÇÊûúÊ≤°ÊúâÊèê‰æõÂÖ∑‰ΩìÊï∞ÂÄºÔºå‰ΩøÁî®ÈªòËÆ§‰º∞ÁÆóÂÄº
                evaluationMetrics.bitsTransmitted.push(1.5);
            }
            
            // ËÆ°ÁÆóÁ¥ØÁßØÊØîÁâπÊï∞
            const totalBits = evaluationMetrics.bitsTransmitted.reduce((sum, bits) => sum + bits, 0);
            evaluationMetrics.cumulativeBits.push(totalBits);
            
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const stats = calculateMetricsStatistics();
            
            // Êõ¥Êñ∞ÁªüËÆ°Èù¢Êùø
            renderMetricsStatistics(stats);
        }
        
        // ËÆ°ÁÆóËØÑ‰º∞ÊåáÊ†áÁªüËÆ°Êï∞ÊçÆ
        function calculateMetricsStatistics() {
            const naturalness = evaluationMetrics.naturalness;
            const coherence = evaluationMetrics.coherence;
            const suspicion = evaluationMetrics.suspicion;
            
            if (naturalness.length === 0) {
                return null;
            }
            
            // ËÆ°ÁÆóÂπ≥ÂùáÂÄº
            const avgNaturalness = naturalness.reduce((a, b) => a + b, 0) / naturalness.length;
            const avgCoherence = coherence.reduce((a, b) => a + b, 0) / coherence.length;
            const avgSuspicion = suspicion.reduce((a, b) => a + b, 0) / suspicion.length;
            
            // ËÆ°ÁÆóË∂ãÂäøÔºàÊúÄÂêé3ËΩÆ‰∏éÂâçÈù¢ËΩÆÊ¨°ÁöÑÊØîËæÉÔºâ
            const getTrend = (values) => {
                if (values.length < 3) return 'stable';
                const recent = values.slice(-3).reduce((a, b) => a + b, 0) / 3;
                const earlier = values.slice(0, -3).reduce((a, b) => a + b, 0) / (values.length - 3);
                const diff = recent - earlier;
                if (Math.abs(diff) < 0.1) return 'stable';
                return diff > 0 ? 'up' : 'down';
            };
            
            // ËÆ°ÁÆó‰º†ËæìÊïàÁéáÔºàÂü∫‰∫éÂÆûÈôÖ‰º†ËæìÊï∞ÊçÆÔºâ
            const totalBits = evaluationMetrics.cumulativeBits.length > 0 ? 
                evaluationMetrics.cumulativeBits[evaluationMetrics.cumulativeBits.length - 1] : 0;
            const avgBitsPerRound = evaluationMetrics.bitsTransmitted.length > 0 ?
                evaluationMetrics.bitsTransmitted.reduce((sum, bits) => sum + bits, 0) / evaluationMetrics.bitsTransmitted.length : 0;
            
            return {
                naturalness: {
                    avg: avgNaturalness,
                    trend: getTrend(naturalness),
                    latest: naturalness[naturalness.length - 1]
                },
                coherence: {
                    avg: avgCoherence,
                    trend: getTrend(coherence),
                    latest: coherence[coherence.length - 1]
                },
                suspicion: {
                    avg: avgSuspicion,
                    trend: getTrend(suspicion),
                    latest: suspicion[suspicion.length - 1]
                },
                capacity: {
                    totalRounds: naturalness.length,
                    totalBits: totalBits,
                    efficiency: avgBitsPerRound,
                    bitsPerRound: evaluationMetrics.bitsTransmitted.slice() // ÊØèËΩÆÊØîÁâπÊï∞Êï∞ÁªÑÁöÑÂâØÊú¨
                }
            };
        }
        
        // Ê∏≤ÊüìËØÑ‰º∞ÊåáÊ†áÁªüËÆ°Èù¢Êùø
        function renderMetricsStatistics(stats) {
            const metricsDiv = document.getElementById('metricsStatistics');
            
            if (!stats) {
                metricsDiv.innerHTML = `
                    <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        <p>Á≠âÂæÖÁªüËÆ°Êï∞ÊçÆ...</p>
                        <p style="font-size: 14px;">ËØÑ‰º∞ÂÆåÊàêÂêéÂ∞ÜÊòæÁ§∫ËØ¶ÁªÜÁªüËÆ°‰ø°ÊÅØ</p>
                    </div>
                `;
                return;
            }
            
            const getTrendIcon = (trend) => {
                switch(trend) {
                    case 'up': return 'üìà';
                    case 'down': return 'üìâ';
                    default: return '‚û°Ô∏è';
                }
            };
            
            const getTrendClass = (trend) => {
                switch(trend) {
                    case 'up': return 'trend-up';
                    case 'down': return 'trend-down';
                    default: return 'trend-stable';
                }
            };
            
            metricsDiv.innerHTML = `
                <div class="metrics-overview">
                    <div class="metric-summary-card naturalness">
                        <div class="metric-summary-value">${stats.naturalness.avg.toFixed(2)}</div>
                        <div class="metric-summary-label">Âπ≥ÂùáËá™ÁÑ∂Â∫¶</div>
                        <div class="metric-summary-trend ${getTrendClass(stats.naturalness.trend)}">
                            ${getTrendIcon(stats.naturalness.trend)} ${stats.naturalness.trend === 'stable' ? 'Á®≥ÂÆö' : stats.naturalness.trend === 'up' ? '‰∏äÂçá' : '‰∏ãÈôç'}
                        </div>
                    </div>
                    
                    <div class="metric-summary-card coherence">
                        <div class="metric-summary-value">${stats.coherence.avg.toFixed(2)}</div>
                        <div class="metric-summary-label">Âπ≥ÂùáËøûË¥ØÊÄß</div>
                        <div class="metric-summary-trend ${getTrendClass(stats.coherence.trend)}">
                            ${getTrendIcon(stats.coherence.trend)} ${stats.coherence.trend === 'stable' ? 'Á®≥ÂÆö' : stats.coherence.trend === 'up' ? '‰∏äÂçá' : '‰∏ãÈôç'}
                        </div>
                    </div>
                    
                    <div class="metric-summary-card suspicion">
                        <div class="metric-summary-value">${stats.suspicion.avg.toFixed(2)}</div>
                        <div class="metric-summary-label">Âπ≥ÂùáÂèØÁñëÂ∫¶</div>
                        <div class="metric-summary-trend ${getTrendClass(stats.suspicion.trend)}">
                            ${getTrendIcon(stats.suspicion.trend)} ${stats.suspicion.trend === 'stable' ? 'Á®≥ÂÆö' : stats.suspicion.trend === 'up' ? '‰∏äÂçá' : '‰∏ãÈôç'}
                        </div>
                    </div>
                    
                    <div class="metric-summary-card capacity">
                        <div class="metric-summary-value">${stats.capacity.totalBits.toFixed(1)}</div>
                        <div class="metric-summary-label">Á¥ØÁßØ‰º†ËæìÊØîÁâπ</div>
                        <div class="metric-summary-trend trend-stable">
                            üìä ${stats.capacity.totalRounds} ËΩÆ
                        </div>
                    </div>
                    
                    <div class="metric-summary-card efficiency" style="grid-column: span 1;">
                        <div class="metric-summary-value">${stats.capacity.efficiency.toFixed(2)}</div>
                        <div class="metric-summary-label">Âπ≥Âùá‰º†ËæìÊïàÁéá</div>
                        <div class="metric-summary-trend trend-stable">
                            ‚ö° ÊØîÁâπ/ËΩÆ
                        </div>
                    </div>
                </div>
                
                <div class="metrics-charts">
                    <div class="chart-container">
                        <div class="chart-title">üìà Ë¥®ÈáèÊåáÊ†áË∂ãÂäø</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.8rem;">
                            <div style="text-align: center;">
                                <div style="color: #27ae60; font-weight: bold;">Ëá™ÁÑ∂Â∫¶</div>
                                <div>${renderMiniChart(evaluationMetrics.naturalness, '#27ae60')}</div>
                                <div style="margin-top: 5px;">ÂΩìÂâç: ${stats.naturalness.latest}/5</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #3498db; font-weight: bold;">ËøûË¥ØÊÄß</div>
                                <div>${renderMiniChart(evaluationMetrics.coherence, '#3498db')}</div>
                                <div style="margin-top: 5px;">ÂΩìÂâç: ${stats.coherence.latest}/5</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #e74c3c; font-weight: bold;">ÂèØÁñëÂ∫¶</div>
                                <div>${renderMiniChart(evaluationMetrics.suspicion, '#e74c3c')}</div>
                                <div style="margin-top: 5px;">ÂΩìÂâç: ${stats.suspicion.latest}/5</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">‚ö° ‰º†ËæìÊïàÁéáÂàÜÊûê</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.8rem;">
                            <div style="text-align: center;">
                                <div style="color: #9b59b6; font-weight: bold;">ÊØèËΩÆ‰º†ËæìÊØîÁâπÊï∞</div>
                                <div>${renderMiniChart(evaluationMetrics.bitsTransmitted, '#9b59b6')}</div>
                                <div style="margin-top: 5px;">Âπ≥Âùá: ${stats.capacity.efficiency.toFixed(2)} ÊØîÁâπ/ËΩÆ</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #f39c12; font-weight: bold;">Á¥ØÁßØ‰º†ËæìÊØîÁâπ</div>
                                <div>${renderMiniChart(evaluationMetrics.cumulativeBits, '#f39c12')}</div>
                                <div style="margin-top: 5px;">ÊÄªËÆ°: ${stats.capacity.totalBits.toFixed(1)} ÊØîÁâπ</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-export">
                    <button class="btn-export" onclick="exportMetricsData('json')">üìÑ ÂØºÂá∫JSON</button>
                    <button class="btn-export" onclick="exportMetricsData('csv')">üìä ÂØºÂá∫CSV</button>
                    <button class="btn-export" onclick="showMetricsDetails()">üîç ËØ¶ÁªÜÂàÜÊûê</button>
                </div>
            `;
        }
        
        // Ê∏≤ÊüìËø∑‰Ω†ÂõæË°®
        function renderMiniChart(data, color) {
            if (data.length === 0) return '<div style="height: 40px; background: #f5f5f5; border-radius: 4px;"></div>';
            
            const max = Math.max(...data, 5); // ÊúÄÂ§ßÂÄºËá≥Â∞ë‰∏∫5
            const min = Math.min(...data, 0); // ÊúÄÂ∞èÂÄºËá≥Â∞ë‰∏∫0
            const range = max - min || 1;
            
            const points = data.map((value, index) => {
                const x = (index / (data.length - 1)) * 100;
                const y = 100 - ((value - min) / range) * 100;
                return `${x},${y}`;
            }).join(' ');
            
            return `
                <svg width="100%" height="40" style="background: rgba(255,255,255,0.5); border-radius: 4px;">
                    <polyline points="${points}" 
                              fill="none" 
                              stroke="${color}" 
                              stroke-width="2" 
                              stroke-linecap="round"/>
                    ${data.map((value, index) => {
                        const x = (index / (data.length - 1)) * 100;
                        const y = 100 - ((value - min) / range) * 100;
                        return `<circle cx="${x}%" cy="${y}%" r="2" fill="${color}"/>`;
                    }).join('')}
                </svg>
            `;
        }
        
        // ÂØºÂá∫ËØÑ‰º∞ÊåáÊ†áÊï∞ÊçÆ
        function exportMetricsData(format) {
            const stats = calculateMetricsStatistics();
            if (!stats) {
                alert('ÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫');
                return;
            }
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            
            if (format === 'json') {
                const data = {
                    timestamp: new Date().toISOString(),
                    session_id: currentSessionId,
                    summary: stats,
                    raw_data: evaluationMetrics
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `evaluation_metrics_${timestamp}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
            } else if (format === 'csv') {
                let csv = 'Round,Naturalness,Coherence,Suspicion,BitsTransmitted,CumulativeBits\n';
                for (let i = 0; i < evaluationMetrics.naturalness.length; i++) {
                    csv += `${evaluationMetrics.rounds[i]},${evaluationMetrics.naturalness[i]},${evaluationMetrics.coherence[i]},${evaluationMetrics.suspicion[i]},${evaluationMetrics.bitsTransmitted[i] || 0},${evaluationMetrics.cumulativeBits[i] || 0}\n`;
                }
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `evaluation_metrics_${timestamp}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // ÊòæÁ§∫ËØ¶ÁªÜÂàÜÊûê
        function showMetricsDetails() {
            const stats = calculateMetricsStatistics();
            if (!stats) {
                alert('ÊöÇÊó†Êï∞ÊçÆÂèØÂàÜÊûê');
                return;
            }
            
            const analysis = generateMetricsAnalysis(stats);
            
            // ÂàõÂª∫Ê®°ÊÄÅÊ°ÜÊòæÁ§∫ËØ¶ÁªÜÂàÜÊûê
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <h3 style="margin-top: 0; color: #2c3e50;">üìä ËØÑ‰º∞ÊåáÊ†áËØ¶ÁªÜÂàÜÊûê</h3>
                    <div style="line-height: 1.6; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">${analysis}</div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="document.body.removeChild(this.closest('div').parentElement)" 
                                style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            ÂÖ≥Èó≠
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ÁîüÊàêËØÑ‰º∞ÊåáÊ†áÂàÜÊûêÊä•Âëä
        function generateMetricsAnalysis(stats) {
            let analysis = '<div style="font-size: 14px;">';
            
            // Êï¥‰ΩìËØÑ‰º∞
            const avgScore = (stats.naturalness.avg + stats.coherence.avg + (5 - stats.suspicion.avg)) / 3;
            analysis += `<h4>üéØ Êï¥‰ΩìËØÑ‰º∞</h4>`;
            analysis += `<p><strong>ÁªºÂêàÂæóÂàÜ:</strong> ${avgScore.toFixed(2)}/5 `;
            analysis += avgScore >= 4 ? '(‰ºòÁßÄ üåü)' : avgScore >= 3 ? '(ËâØÂ•Ω üëç)' : avgScore >= 2 ? '(‰∏ÄËà¨ üòê)' : '(ÈúÄÊîπËøõ ‚ö†Ô∏è)';
            analysis += `</p>`;
            
            // ÂêÑÈ°πÊåáÊ†áÂàÜÊûê
            analysis += `<h4>üìà ÊåáÊ†áÂàÜÊûê</h4>`;
            analysis += `<ul>`;
            analysis += `<li><strong>Ëá™ÁÑ∂Â∫¶:</strong> ${stats.naturalness.avg.toFixed(2)}/5 - ${stats.naturalness.avg >= 4 ? 'ÊñáÊú¨ÈùûÂ∏∏Ëá™ÁÑ∂' : stats.naturalness.avg >= 3 ? 'ÊñáÊú¨ËæÉ‰∏∫Ëá™ÁÑ∂' : 'ÊñáÊú¨Ëá™ÁÑ∂Â∫¶ÊúâÂæÖÊèêÂçá'}</li>`;
            analysis += `<li><strong>ËøûË¥ØÊÄß:</strong> ${stats.coherence.avg.toFixed(2)}/5 - ${stats.coherence.avg >= 4 ? 'ÂØπËØùËøûË¥ØÊÄßÂæàÂ•Ω' : stats.coherence.avg >= 3 ? 'ÂØπËØùËøûË¥ØÊÄßËâØÂ•Ω' : 'ÂØπËØùËøûË¥ØÊÄßÈúÄË¶ÅÊîπËøõ'}</li>`;
            analysis += `<li><strong>ÂèØÁñëÂ∫¶:</strong> ${stats.suspicion.avg.toFixed(2)}/5 - ${stats.suspicion.avg <= 2 ? 'ÈöêËîΩÊÄßÂæàÂ•Ω' : stats.suspicion.avg <= 3 ? 'ÈöêËîΩÊÄßËâØÂ•Ω' : 'ÈöêËîΩÊÄßÈúÄË¶ÅÊèêÂçá'}</li>`;
            analysis += `</ul>`;
            
            // Ë∂ãÂäøÂàÜÊûê
            analysis += `<h4>üìä Ë∂ãÂäøÂàÜÊûê</h4>`;
            analysis += `<ul>`;
            analysis += `<li><strong>Ëá™ÁÑ∂Â∫¶Ë∂ãÂäø:</strong> ${stats.naturalness.trend === 'up' ? '‰∏äÂçáË∂ãÂäøÔºåÊñáÊú¨Ë¥®ÈáèÂú®ÊîπÂñÑ' : stats.naturalness.trend === 'down' ? '‰∏ãÈôçË∂ãÂäøÔºåÈúÄË¶ÅÊ≥®ÊÑèÊñáÊú¨Ë¥®Èáè' : '‰øùÊåÅÁ®≥ÂÆö'}</li>`;
            analysis += `<li><strong>ËøûË¥ØÊÄßË∂ãÂäø:</strong> ${stats.coherence.trend === 'up' ? '‰∏äÂçáË∂ãÂäøÔºåÂØπËØùËøûË¥ØÊÄßÂú®ÊèêÂçá' : stats.coherence.trend === 'down' ? '‰∏ãÈôçË∂ãÂäøÔºåÈúÄË¶ÅÊîπËøõÂØπËØùÁ≠ñÁï•' : '‰øùÊåÅÁ®≥ÂÆö'}</li>`;
            analysis += `<li><strong>ÂèØÁñëÂ∫¶Ë∂ãÂäø:</strong> ${stats.suspicion.trend === 'up' ? '‰∏äÂçáË∂ãÂäøÔºåÈúÄË¶Å‰ºòÂåñÈöêÂÜôÁ≠ñÁï•' : stats.suspicion.trend === 'down' ? '‰∏ãÈôçË∂ãÂäøÔºåÈöêËîΩÊÄßÂú®ÊèêÂçá' : '‰øùÊåÅÁ®≥ÂÆö'}</li>`;
            analysis += `</ul>`;
            
            // ‰º†ËæìÊïàÁéá
            analysis += `<h4>‚ö° ‰º†ËæìÊïàÁéá</h4>`;
            analysis += `<p>Â∑≤ÂÆåÊàê <strong>${stats.capacity.totalRounds}</strong> ËΩÆÂØπËØùÔºåÁ¥ØÁßØ‰º†Ëæì <strong>${stats.capacity.totalBits.toFixed(1)}</strong> ÊØîÁâπÊï∞ÊçÆÔºåÂπ≥ÂùáÊØèËΩÆ‰º†Ëæì <strong>${stats.capacity.efficiency.toFixed(2)}</strong> ÊØîÁâπ„ÄÇ</p>`;
            
            // ‰º†ËæìÊïàÁéáËØ¶ÁªÜÂàÜÊûê
            if (evaluationMetrics.bitsTransmitted.length > 0) {
                const minBits = Math.min(...evaluationMetrics.bitsTransmitted);
                const maxBits = Math.max(...evaluationMetrics.bitsTransmitted);
                const variability = maxBits - minBits;
                analysis += `<p><strong>‰º†ËæìÊïàÁéáËØ¶ÊÉÖ:</strong></p>`;
                analysis += `<ul>`;
                analysis += `<li>ÊúÄÈ´òÂçïËΩÆ‰º†Ëæì: <strong>${maxBits.toFixed(2)}</strong> ÊØîÁâπ</li>`;
                analysis += `<li>ÊúÄ‰ΩéÂçïËΩÆ‰º†Ëæì: <strong>${minBits.toFixed(2)}</strong> ÊØîÁâπ</li>`;
                analysis += `<li>‰º†ËæìÊïàÁéáÂèòÂºÇÊÄß: <strong>${variability.toFixed(2)}</strong> ÊØîÁâπ (${variability < 1 ? 'Á®≥ÂÆö' : variability < 2 ? '‰∏≠Á≠â' : 'ËæÉÂ§ßÂèòÂåñ'})</li>`;
                analysis += `</ul>`;
            }
            
            // Âª∫ËÆÆ
            analysis += `<h4>üí° ‰ºòÂåñÂª∫ËÆÆ</h4>`;
            analysis += `<ul>`;
            if (stats.naturalness.avg < 3.5) {
                analysis += `<li>Âª∫ËÆÆ‰ºòÂåñÊñáÊú¨ÁîüÊàêÁ≠ñÁï•ÔºåÊèêÈ´òËá™ÁÑ∂Â∫¶</li>`;
            }
            if (stats.coherence.avg < 3.5) {
                analysis += `<li>Âª∫ËÆÆÂ¢ûÂº∫‰∏ä‰∏ãÊñáÁêÜËß£ÔºåÊèêÈ´òÂØπËØùËøûË¥ØÊÄß</li>`;
            }
            if (stats.suspicion.avg > 3) {
                analysis += `<li>Âª∫ËÆÆË∞ÉÊï¥ÈöêÂÜôÂèÇÊï∞ÔºåÈôç‰ΩéÂèØÁñëÂ∫¶</li>`;
            }
            if (stats.capacity.efficiency < 1) {
                analysis += `<li>Âª∫ËÆÆ‰ºòÂåñÁºñÁ†ÅÁÆóÊ≥ïÔºåÊèêÈ´ò‰º†ËæìÊïàÁéá</li>`;
            }
            if (evaluationMetrics.bitsTransmitted.length > 0) {
                const variability = Math.max(...evaluationMetrics.bitsTransmitted) - Math.min(...evaluationMetrics.bitsTransmitted);
                if (variability > 1.5) {
                    analysis += `<li>‰º†ËæìÊïàÁéáÊ≥¢Âä®ËæÉÂ§ßÔºåÂª∫ËÆÆË∞ÉÊï¥ÈöêÂÜôÂèÇÊï∞‰ª•Á®≥ÂÆö‰º†ËæìÊÄßËÉΩ</li>`;
                }
            }
            analysis += `</ul>`;
            
            analysis += '</div>';
            return analysis;
        }

        // Ê∑ªÂä†ËØÑ‰º∞ÁªìÊûúÂà∞Áã¨Á´ãÈù¢Êùø
        function addEvaluationToPanel(evaluation) {
            const evaluationResults = document.getElementById('evaluationResults');
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏Ä‰∏™ËØÑ‰º∞ÁªìÊûúÔºåÊ∏ÖÁ©∫ÂàùÂßãÊèêÁ§∫
            if (evaluationResults.children.length === 1 && evaluationResults.children[0].textContent.includes('Á≠âÂæÖËØÑ‰º∞ÁªìÊûú')) {
                evaluationResults.innerHTML = '';
            }
            
            const roundDiv = document.createElement('div');
            roundDiv.className = 'evaluation-round';
            
            // ËΩÆÊï∞Ê†áÈ¢òÂíåÊó∂Èó¥Êà≥
            const headerDiv = document.createElement('div');
            headerDiv.className = 'evaluation-round-header';
            headerDiv.innerHTML = `
                <span class="round-number">Á¨¨ ${currentRound} ËΩÆÂØπËØù</span>
                <span class="round-timestamp">${new Date().toLocaleString()}</span>
            `;
            
            // ËØÑ‰º∞ÊëòË¶Å
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'evaluation-summary';
            
            // Ëá™ÁÑ∂Â∫¶
            const naturalDiv = document.createElement('div');
            naturalDiv.className = 'summary-item summary-naturalness';
            naturalDiv.innerHTML = `
                <span class="summary-score">${evaluation.naturalness_score}/5</span>
                <div class="summary-label">Ëá™ÁÑ∂Â∫¶</div>
            `;
            
            // ËøûË¥ØÊÄß
            const coherenceDiv = document.createElement('div');
            coherenceDiv.className = 'summary-item summary-coherence';
            coherenceDiv.innerHTML = `
                <span class="summary-score">${evaluation.intentional_coherence_score}/5</span>
                <div class="summary-label">ËøûË¥ØÊÄß</div>
            `;
            
            // ÂèØÁñëÂ∫¶
            const suspicionDiv = document.createElement('div');
            suspicionDiv.className = 'summary-item summary-suspicion';
            suspicionDiv.innerHTML = `
                <span class="summary-score">${evaluation.suspicion_score}/5</span>
                <div class="summary-label">ÂèØÁñëÂ∫¶</div>
            `;
            
            summaryDiv.appendChild(naturalDiv);
            summaryDiv.appendChild(coherenceDiv);
            summaryDiv.appendChild(suspicionDiv);
            
            // ËØ¶ÁªÜËØ¥Êòé
            const detailsDiv = document.createElement('details');
            detailsDiv.className = 'evaluation-details-panel';
            
            const summaryElement = document.createElement('summary');
            summaryElement.textContent = 'üìã Êü•ÁúãËØ¶ÁªÜËØÑ‰º∞ÁêÜÁî±';
            
            const detailsContent = document.createElement('div');
            
            // Ê∏≤ÊüìËØÑ‰º∞ÁêÜÁî±ÔºåÊîØÊåÅmarkdown
            function renderEvaluationText(text) {
                if (typeof marked !== 'undefined' && isMarkdownContent(text)) {
                    try {
                        return marked.parse(text);
                    } catch (error) {
                        console.warn('ËØÑ‰º∞ÊñáÊú¨MarkdownËß£ÊûêÂ§±Ë¥•:', error);
                        return text;
                    }
                }
                return text;
            }
            
            detailsContent.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">üåø Ëá™ÁÑ∂Â∫¶ËØÑ‰º∞:</div>
                    <div class="message-content">${renderEvaluationText(evaluation.naturalness_justification)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">üîó ËøûË¥ØÊÄßËØÑ‰º∞:</div>
                    <div class="message-content">${renderEvaluationText(evaluation.intentional_coherence_justification)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">üîç ÂèØÁñëÂ∫¶ËØÑ‰º∞:</div>
                    <div class="message-content">${renderEvaluationText(evaluation.suspicion_justification)}</div>
                </div>
            `;
            
            detailsDiv.appendChild(summaryElement);
            detailsDiv.appendChild(detailsContent);
            
            // ÁªÑË£ÖÂÆåÊï¥ÁöÑËΩÆÊ¨°ËØÑ‰º∞
            roundDiv.appendChild(headerDiv);
            roundDiv.appendChild(summaryDiv);
            roundDiv.appendChild(detailsDiv);
            
            // ÊèíÂÖ•Âà∞È°∂ÈÉ®ÔºàÊúÄÊñ∞ÁöÑÂú®‰∏äÈù¢Ôºâ
            evaluationResults.insertBefore(roundDiv, evaluationResults.firstChild);
            
            // ÊªöÂä®Âà∞È°∂ÈÉ®ÊòæÁ§∫ÊúÄÊñ∞ÁªìÊûú
            evaluationResults.scrollTop = 0;
        }

        // Ê£ÄÊü•A2AÊúçÂä°Âô®Áä∂ÊÄÅ
        async function checkA2AServerStatus() {
            try {
                const response = await fetch('http://localhost:9998/status');
                if (response.ok) {
                    const data = await response.json();
                    const statusElement = document.getElementById('a2aServerStatus');
                    const startBtn = document.getElementById('startA2AServerBtn');
                    const stopBtn = document.getElementById('stopA2AServerBtn');
                    
                    if (data.status === 'running') {
                        statusElement.textContent = 'ËøêË°å‰∏≠';
                        statusElement.className = 'status-online';
                        startBtn.disabled = true;
                        stopBtn.disabled = false;
                    } else {
                        statusElement.textContent = 'Â∑≤ÂÅúÊ≠¢';
                        statusElement.className = 'status-offline';
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                    }
                } else {
                    throw new Error('ÊúçÂä°Âô®ÂåÖË£ÖÂô®ÂìçÂ∫îÈîôËØØ');
                }
            } catch (error) {
                document.getElementById('a2aServerStatus').textContent = 'Á¶ªÁ∫ø';
                document.getElementById('a2aServerStatus').className = 'status-offline';
                document.getElementById('startA2AServerBtn').disabled = false;
                document.getElementById('stopA2AServerBtn').disabled = true;
                console.error('A2AÊúçÂä°Âô®Áä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', error);
            }
        }

        // Ê£ÄÊü•ÂÆ¢Êà∑Á´ØÂåÖË£ÖÂô®Áä∂ÊÄÅ
        async function checkClientWrapperStatus() {
            try {
                const clientResponse = await fetch('http://localhost:8889/');
                if (clientResponse.ok) {
                    document.getElementById('clientWrapperStatus').textContent = 'Âú®Á∫ø';
                    document.getElementById('clientWrapperStatus').className = 'status-online';
                } else {
                    throw new Error('ÂÆ¢Êà∑Á´ØÊúçÂä°ÂìçÂ∫îÈîôËØØ');
                }
            } catch (error) {
                document.getElementById('clientWrapperStatus').textContent = 'Á¶ªÁ∫ø';
                document.getElementById('clientWrapperStatus').className = 'status-offline';
                console.error('ÂÆ¢Êà∑Á´ØÂåÖË£ÖÂô®Áä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', error);
            }
        }

        // Ê£ÄÊü•ËØÑ‰º∞ÊúçÂä°Áä∂ÊÄÅ
        async function checkEvaluationStatus() {
            try {
                // ÈÄöËøáÂÆ¢Êà∑Á´ØÂåÖË£ÖÂô®Ê£ÄÊü•ËØÑ‰º∞Âô®Áä∂ÊÄÅ
                const response = await fetch('http://localhost:8889/evaluation/status');
                if (response.ok) {
                    const data = await response.json();
                    const statusElement = document.getElementById('evaluationStatus');
                    if (data.available) {
                        statusElement.textContent = 'ÂèØÁî®';
                        statusElement.className = 'status-online';
                    } else {
                        statusElement.textContent = '‰∏çÂèØÁî®';
                        statusElement.className = 'status-offline';
                    }
                } else {
                    throw new Error('ËØÑ‰º∞ÊúçÂä°Ê£ÄÊü•Â§±Ë¥•');
                }
            } catch (error) {
                document.getElementById('evaluationStatus').textContent = '‰∏çÂèØÁî®';
                document.getElementById('evaluationStatus').className = 'status-offline';
                console.error('ËØÑ‰º∞ÊúçÂä°Áä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', error);
            }
        }

        // ÂêØÂä®A2AÊúçÂä°Âô®
        async function startA2AServer() {
            try {
                const config = {
                    stego_model_path: document.getElementById('serverStegoModel').value,
                    stego_algorithm: document.getElementById('serverStegoAlgorithm').value,
                    stego_key: document.getElementById('serverStegoKey').value,
                    decrypted_bits_path: document.getElementById('decryptedBitsPath').value,
                    session_id: currentSessionId,
                    server_url: 'http://localhost:9999'
                };

                const response = await fetch('http://localhost:9998/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('A2AÊúçÂä°Âô®ÂêØÂä®ÊàêÂäüÔºÅ');
                    await checkA2AServerStatus();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'ÂêØÂä®Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂêØÂä®A2AÊúçÂä°Âô®Â§±Ë¥•:', error);
                alert(`ÂêØÂä®A2AÊúçÂä°Âô®Â§±Ë¥•: ${error.message}`);
            }
        }

        // ÂÅúÊ≠¢A2AÊúçÂä°Âô®
        async function stopA2AServer() {
            try {
                const response = await fetch('http://localhost:9998/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    alert('A2AÊúçÂä°Âô®Â∑≤ÂÅúÊ≠¢');
                    await checkA2AServerStatus();
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'ÂÅúÊ≠¢Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂÅúÊ≠¢A2AÊúçÂä°Âô®Â§±Ë¥•:', error);
                alert(`ÂÅúÊ≠¢A2AÊúçÂä°Âô®Â§±Ë¥•: ${error.message}`);
            }
        }

        // ÂêØÂä®ÈöêËîΩÈÄö‰ø°
        async function startCommunication() {
            // Ê£ÄÊü•ÊúçÂä°Âô®Áä∂ÊÄÅ
            await checkA2AServerStatus();
            await checkClientWrapperStatus();
            
            const a2aServerStatus = document.getElementById('a2aServerStatus').textContent;
            const clientWrapperStatus = document.getElementById('clientWrapperStatus').textContent;
            
            if (a2aServerStatus !== 'ËøêË°å‰∏≠') {
                alert('ËØ∑ÂÖàÂêØÂä®A2AÊúçÂä°Âô®');
                return;
            }
            
            if (clientWrapperStatus !== 'Âú®Á∫ø') {
                alert('ËØ∑Á°Æ‰øùÂÆ¢Êà∑Á´ØÂåÖË£ÖÂô®ÊúçÂä°Âú®Á∫ø');
                return;
            }

            try {
                isRunning = true;
                currentSessionId = generateUUID();
                currentRound = 0; // ÈáçÁΩÆËΩÆÊï∞
                
                // Êõ¥Êñ∞UIÁä∂ÊÄÅ
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('loading').style.display = 'block';
                document.getElementById('currentPhase').textContent = 'ÂáÜÂ§á‰∏≠...';
                
                // Ê∏ÖÁ©∫Ê∂àÊÅØ
                document.getElementById('messages').innerHTML = '';
                
                // Ê∏ÖÁ©∫ËØÑ‰º∞ÁªìÊûú
                document.getElementById('evaluationResults').innerHTML = `
                    <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                        <p>Á≠âÂæÖËØÑ‰º∞ÁªìÊûú...</p>
                        <p style="font-size: 14px;">ÂØπËØùÂºÄÂßãÂêéÂ∞ÜÊòæÁ§∫ÊØèËΩÆÁöÑËØÑ‰º∞ÁªìÊûú</p>
                    </div>
                `;
                
                // Ê∑ªÂä†ÂºÄÂßãÊ∂àÊÅØ
                addMessage('system', 'üöÄ ÂºÄÂßãÈöêËîΩÈÄö‰ø°ÊºîÁ§∫...', { isSystemMessage: true });
                
                // ÂáÜÂ§áÈÖçÁΩÆ - ‰ΩøÁî®ÂÆ¢Êà∑Á´ØÁöÑÈöêÂÜôÁÆóÊ≥ï
                const config = {
                    stego_model_path: document.getElementById('serverStegoModel').value,
                    stego_algorithm: document.getElementById('clientStegoAlgorithm').value,
                    question_path: document.getElementById('questionPath').value,
                    question_index: parseInt(document.getElementById('questionIndex').value),
                    stego_key: document.getElementById('serverStegoKey').value, // ‰ΩøÁî®ÊúçÂä°Âô®ÁöÑÂØÜÈí•Á°Æ‰øù‰∏ÄËá¥
                    secret_bit_path: `data/stego/secret_bits_${currentSessionId}.txt`,
                    server_url: 'http://localhost:9999',
                    session_id: currentSessionId
                };

                                 // ‰øùÂ≠òÈöêËîΩ‰ø°ÊÅØ
                 const secretMessage = document.getElementById('secretMessage').value;
                 await fetch('http://localhost:8889/save_secret', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({
                         session_id: currentSessionId,
                         secret_bits: secretMessage
                     })
                 });

                 // ÂêØÂä®ÂÆ¢Êà∑Á´Ø
                 const response = await fetch('http://localhost:8889/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (!response.ok) {
                    throw new Error(`ÂêØÂä®Â§±Ë¥•: ${response.status}`);
                }

                document.getElementById('currentPhase').textContent = 'ËøûÊé•‰∏≠...';
                addMessage('system', 'Ê≠£Âú®ÂêØÂä®ÂÆ¢Êà∑Á´ØÔºåÂª∫Á´ãÈöêËîΩ‰ø°ÈÅì...', { isSystemMessage: true });

                // Âª∫Á´ãWebSocketËøûÊé•Ëé∑ÂèñÂÆûÊó∂ÈÄö‰ø°Êï∞ÊçÆ
                setupWebSocketConnection(currentSessionId);

            } catch (error) {
                console.error('ÂêØÂä®ÈÄö‰ø°Â§±Ë¥•:', error);
                addMessage('system', `ÂêØÂä®Â§±Ë¥•: ${error.message}`, { isError: true });
                finishCommunication();
            }
        }

                 // ÂÅúÊ≠¢ÈöêËîΩÈÄö‰ø°
         async function stopCommunication() {
             try {
                 await fetch('http://localhost:8889/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_id: currentSessionId })
                });
            } catch (error) {
                console.error('ÂÅúÊ≠¢ÈÄö‰ø°Â§±Ë¥•:', error);
            }
            
            addMessage('system', '‚èπÔ∏è ÈÄö‰ø°Â∑≤ÂÅúÊ≠¢', { isSystemMessage: true });
            finishCommunication();
        }

        // ÂÆåÊàêÈÄö‰ø°
        function finishCommunication() {
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('currentPhase').textContent = 'Á©∫Èó≤';
            
            // ÂÖ≥Èó≠WebSocketËøûÊé•
            if (websocket) {
                websocket.close();
                websocket = null;
            }
        }

        // ÊµãËØïMarkdownÊ∏≤ÊüìÂäüËÉΩ
        function testMarkdown() {
            const testMarkdownContent = `## üß™ MarkdownÊ∏≤ÊüìÊµãËØï

**Á≤ó‰ΩìÊñáÊú¨** Âíå *Êñú‰ΩìÊñáÊú¨*

### ‰ª£Á†ÅÁ§∫‰æã
ËøôÊòØ‰∏Ä‰∏™Ë°åÂÜÖ‰ª£Á†ÅÔºö\`console.log('Hello World')\`

‰ª£Á†ÅÂùóÔºö
\`\`\`javascript
function greet(name) {
    return \`Hello, \${name}!\`;
}
\`\`\`

### ÂàóË°®Á§∫‰æã
- Êó†Â∫èÂàóË°®È°π 1
- Êó†Â∫èÂàóË°®È°π 2
  - ÂµåÂ•óÈ°π

1. ÊúâÂ∫èÂàóË°®È°π 1
2. ÊúâÂ∫èÂàóË°®È°π 2

### ÂºïÁî®
> ËøôÊòØ‰∏Ä‰∏™ÂºïÁî®Âùó
> ÂèØ‰ª•ÂåÖÂê´Â§öË°åÂÜÖÂÆπ

### ÈìæÊé•
[ËÆøÈóÆGitHub](https://github.com)

---
*ÊµãËØïÂÆåÊàêÔºÅ*`;

            addMessage('system', testMarkdownContent);
        }

        // ÊµãËØïËØÑ‰º∞ÊåáÊ†áÁªüËÆ°ÂäüËÉΩ
        function testMetricsDemo() {
            // Ê®°Êãü‰∏Ä‰∫õËØÑ‰º∞Êï∞ÊçÆÂíå‰º†ËæìÊØîÁâπÊï∞
            const demoData = [
                { evaluation: { naturalness_score: 4.2, intentional_coherence_score: 4.0, suspicion_score: 2.1 }, bits: 2.3 },
                { evaluation: { naturalness_score: 4.5, intentional_coherence_score: 4.3, suspicion_score: 1.8 }, bits: 1.8 },
                { evaluation: { naturalness_score: 3.8, intentional_coherence_score: 3.9, suspicion_score: 2.5 }, bits: 2.1 },
                { evaluation: { naturalness_score: 4.1, intentional_coherence_score: 4.2, suspicion_score: 2.0 }, bits: 1.6 },
                { evaluation: { naturalness_score: 4.4, intentional_coherence_score: 4.1, suspicion_score: 1.9 }, bits: 2.4 }
            ];

            // ÈáçÁΩÆÊï∞ÊçÆ
            evaluationMetrics = {
                naturalness: [],
                coherence: [],
                suspicion: [],
                rounds: [],
                bitsTransmitted: [],
                cumulativeBits: []
            };
            currentRound = 0;

            // ÈÄêÊ≠•Ê∑ªÂä†ÊºîÁ§∫Êï∞ÊçÆ
            demoData.forEach((data, index) => {
                setTimeout(() => {
                    currentRound = index + 1;
                    updateMetricsStatistics(data.evaluation, data.bits);
                    
                    // Ê∑ªÂä†ÂØπÂ∫îÁöÑÁ≥ªÁªüÊ∂àÊÅØ
                    addMessage('system', `üìä ÊºîÁ§∫Êï∞ÊçÆ - Á¨¨${currentRound}ËΩÆËØÑ‰º∞: Ëá™ÁÑ∂Â∫¶ ${data.evaluation.naturalness_score}, ËøûË¥ØÊÄß ${data.evaluation.intentional_coherence_score}, ÂèØÁñëÂ∫¶ ${data.evaluation.suspicion_score}, ‰º†Ëæì ${data.bits} ÊØîÁâπ`);
                }, index * 800);
            });

            addMessage('system', 'üß™ ÂºÄÂßãËØÑ‰º∞ÊåáÊ†áÁªüËÆ°ÊºîÁ§∫...');
        }

        // ÈáçÁΩÆÁ≥ªÁªü
        function resetSystem() {
            if (isRunning) {
                stopCommunication();
            }
            
            // ÂÖ≥Èó≠WebSocketËøûÊé•
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            
            // ÈáçÁΩÆËΩÆÊï∞ÂíåËØÑ‰º∞Êï∞ÊçÆ
            currentRound = 0;
            evaluationMetrics = {
                naturalness: [],
                coherence: [],
                suspicion: [],
                rounds: [],
                bitsTransmitted: [],
                cumulativeBits: []
            };
            
            // ÈáçÁΩÆÂØπËØùÁ™óÂè£
            document.getElementById('messages').innerHTML = `
                <div class="text-center" style="padding: 40px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                    <p>Á≠âÂæÖAgentÂºÄÂßãÂØπËØù...</p>
                    <p style="font-size: 14px;">ÁÇπÂáª"ÂêØÂä®ÈöêËîΩÈÄö‰ø°"ÊåâÈíÆÂºÄÂßãÊºîÁ§∫</p>
                </div>
            `;
            
            // ÈáçÁΩÆËØÑ‰º∞ÁªìÊûúÈù¢Êùø
            document.getElementById('evaluationResults').innerHTML = `
                <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                    <p>Á≠âÂæÖËØÑ‰º∞ÁªìÊûú...</p>
                    <p style="font-size: 14px;">ÂØπËØùÂºÄÂßãÂêéÂ∞ÜÊòæÁ§∫ÊØèËΩÆÁöÑËØÑ‰º∞ÁªìÊûú</p>
                </div>
            `;
            
            // ÈáçÁΩÆËØÑ‰º∞ÊåáÊ†áÁªüËÆ°Èù¢Êùø
            document.getElementById('metricsStatistics').innerHTML = `
                <div class="text-center" style="padding: 20px; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);">
                    <p>Á≠âÂæÖÁªüËÆ°Êï∞ÊçÆ...</p>
                    <p style="font-size: 14px;">ËØÑ‰º∞ÂÆåÊàêÂêéÂ∞ÜÊòæÁ§∫ËØ¶ÁªÜÁªüËÆ°‰ø°ÊÅØ</p>
                </div>
            `;
            
            currentSessionId = generateUUID();
        }

        // ËØªÂèñÂπ∂ÊòæÁ§∫AgentÈÄâÊã©‰ø°ÊÅØ
        function loadAgentSelection() {
            const selectionData = localStorage.getItem('covertCommunicationSelection');
            if (selectionData) {
                try {
                    const data = JSON.parse(selectionData);
                    document.getElementById('senderName').textContent = data.sender.name;
                    document.getElementById('receiverName').textContent = data.receiver.name;
                    document.getElementById('selectionInfo').style.display = 'block';
                    
                    // Ê∑ªÂä†Á≥ªÁªüÊ∂àÊÅØÊòæÁ§∫ÈÄâÊã©‰ø°ÊÅØ
                    addMessage('system', `üéØ Â∑≤ÈÄâÊã©ÈöêËîΩÈÄö‰ø°Ë∑ØÂæÑÔºö${data.sender.name} (ÂèëÈÄÅÊñπ) ‚Üí ${data.receiver.name} (Êé•Êî∂Êñπ)`);
                } catch (error) {
                    console.error('Ëß£ÊûêAgentÈÄâÊã©Êï∞ÊçÆÂ§±Ë¥•:', error);
                }
            }
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateMessageLength();
            checkA2AServerStatus();
            checkClientWrapperStatus();
            checkEvaluationStatus();
            currentSessionId = generateUUID();
            
            // Âä†ËΩΩAgentÈÄâÊã©‰ø°ÊÅØ
            loadAgentSelection();
            
            document.getElementById('secretMessage').addEventListener('input', updateMessageLength);
            
            // ÂÆöÊúüÊ£ÄÊü•ÊúçÂä°Âô®Áä∂ÊÄÅ
            setInterval(() => {
                checkA2AServerStatus();
                checkClientWrapperStatus();
                checkEvaluationStatus();
            }, 30000);
        });
    </script>
</body>
</html> 