# 前端A2A服务器集成说明

## 问题描述
之前前端的A2A服务器启动按钮只是简单地更新UI状态，没有实际连接到后端API来启动真正的服务器进程。

## 解决方案
现在前端已经集成了后端API调用，可以真正启动和停止A2A服务器。

## 修改内容

### 1. 前端组件更新 (`frontend/src/components/a2a-covert-demo.tsx`)
- 添加了真实的API调用到 `server_wrapper.py`
- 实现了异步的服务器启动、停止和状态检查功能
- 添加了加载状态和错误处理
- 组件加载时自动检查服务器状态

### 2. API端点
- **启动服务器**: `POST http://localhost:9998/start`
- **停止服务器**: `POST http://localhost:9998/stop`  
- **检查状态**: `GET http://localhost:9998/status`

## 使用方法

### 1. 启动后端服务
首先需要启动服务器包装器：

```bash
# 在终端1中运行
python server_wrapper.py
```

这将启动API服务器在端口9998上。

### 2. 启动前端
```bash
# 在终端2中运行
cd frontend
npm run dev
```

### 3. 测试连接
运行测试脚本验证API连接：

```bash
python test_api_connection.py
```

### 4. 使用前端界面
1. 打开浏览器访问 `http://localhost:3000`
2. 在A2A服务器配置区域，点击"启动A2A服务器"按钮
3. 系统会调用后端API真正启动服务器进程
4. 状态指示器会显示真实的服务器状态
5. 可以点击"停止A2A服务器"来停止服务器

## 功能特性

### 按钮状态管理
- **启动按钮**: 当服务器离线且不在连接中时可用
- **停止按钮**: 当服务器在线且不在连接中时可用
- **重置系统按钮**: 随时可以点击，会执行完整的系统重置
- **加载状态**: 操作进行中时显示旋转图标和相应的状态文本

### 错误处理
- 网络连接失败时会在控制台显示错误信息
- API调用失败时会更新UI状态
- 自动重试机制（通过刷新按钮）

### 状态同步
- 组件加载时自动检查服务器状态
- 实时反映服务器的真实运行状态
- 防止重复启动或停止操作

### 系统重置功能
点击"重置系统"按钮会执行以下操作：
1. **停止客户端通信**: 停止所有正在进行的隐蔽通信会话
2. **重启服务器**: 如果服务器正在运行，会先停止再重新启动
3. **清空对话历史**: 清除所有Agent对话记录
4. **清空评估结果**: 清除所有评估数据
5. **重置文件状态**: 清除所有已上传的文件
6. **恢复默认配置**: 重置隐蔽信息到默认值
7. **确认对话框**: 操作前会显示确认对话框，防止误操作

**注意**: 重置操作不可撤销，会丢失所有当前会话数据。

## 技术细节

### API调用配置
```javascript
// 启动服务器配置
const config = {
  stego_model_path: '/root/autodl-tmp/Llama-3.2-3B-Instruct',
  stego_algorithm: 'meteor',
  stego_key: '7b9ec09254aa4a7589e4d0cfd80d46cc',
  decrypted_bits_path: 'data/stego/decrypted_bits.txt',
  session_id: 'covert-session-uuid-44195c6d-d09e-4191-9bcb-d22a85b7d126',
  server_url: 'http://localhost:9999'
};
```

### 状态映射
- `"running"` (API) → `"online"` (UI)
- `"stopped"` (API) → `"offline"` (UI)

## 故障排除

### 常见问题

1. **"无法连接到后端服务"**
   - 确保 `server_wrapper.py` 正在运行
   - 检查端口9998是否被占用
   - 查看控制台错误信息

2. **服务器启动失败**
   - 检查模型路径是否正确
   - 确保有足够的系统资源
   - 查看 `logs/server.log` 文件

3. **状态不同步**
   - 点击刷新按钮手动同步状态
   - 检查网络连接
   - 重启后端服务

### 日志文件
- 服务器日志: `logs/server.log`
- 前端控制台: 浏览器开发者工具
- API日志: 运行 `server_wrapper.py` 的终端

## 下一步改进

1. 添加WebSocket实时状态更新
2. 实现服务器配置的UI界面
3. 添加更详细的错误提示
4. 实现服务器日志的实时显示
5. 添加服务器性能监控
